# MemoryNotebook æ¦‚å¿µåŸå‹ - è®¾è®¡å†³ç­–ä¸åé¦ˆæ±‡æ€»

> æ—¥æœŸ: 2025-12-09
> çŠ¶æ€: âœ… æ¦‚å¿µåŸå‹å®Œæˆï¼Œå¾…è¿­ä»£

## 1. è®¾è®¡æ„å›¾

### æ ¸å¿ƒé—®é¢˜
LLM Agent çš„ä¸Šä¸‹æ–‡çª—å£æœ‰é™ï¼Œå¦‚ä½•é«˜æ•ˆç®¡ç†ä¿¡æ¯ç„¦ç‚¹ï¼Ÿ

### è§£å†³æ–¹æ¡ˆ
LOD (Level of Detail) ä¸‰çº§æ§åˆ¶ï¼š
- **Gist**: æœ€å°å°è±¡ï¼Œä¸€å¥è¯ï¼ˆå¦‚ "è¯¥ä¹°é¸¡è›‹äº†"ï¼‰
- **Summary**: æ‘˜è¦ï¼Œä¿ç•™å…³é”®ä¿¡æ¯ï¼ˆæ—¥å¸¸å·¥ä½œçŠ¶æ€ï¼‰
- **Full**: å®Œæ•´å†…å®¹ï¼ˆéœ€è¦è¯¦ç»†æŸ¥çœ‹æ—¶ï¼‰

### å…³é”®æ´å¯Ÿ
æ¥è‡ª GeminiAdvisor çš„é‡è¦è§‚ç‚¹ï¼š
> å¯¹ LLMï¼ŒæŠ˜å å¿…é¡»æ˜¯**å†…å®¹æ›¿æ¢**ï¼Œä¸æ˜¯è§†è§‰éšè—ã€‚`<details>` æ ‡ç­¾å¯¹ LLM æ¯«æ— æ„ä¹‰ã€‚

## 2. å®ç°æˆæœ

### é¡¹ç›®ç»“æ„
```
DocUI/samples/MemoryNotebook/
â”œâ”€â”€ Model/
â”‚   â”œâ”€â”€ LodLevel.cs          # enum { Gist=0, Summary=1, Full=2 }
â”‚   â”œâ”€â”€ ContentNode.cs       # å†…å®¹èŠ‚ç‚¹ + LodContent
â”‚   â””â”€â”€ Notebook.cs          # æ•°æ®å­˜å‚¨ + Markdown æ¸²æŸ“
â”œâ”€â”€ SampleData.cs            # ç¤ºä¾‹æ•°æ®å·¥å‚
â”œâ”€â”€ Program.cs               # PipeMux App å…¥å£
â””â”€â”€ MemoryNotebook.csproj
```

### å‘½ä»¤åˆ—è¡¨
| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| `pmux notebook view [--lod]` | æŸ¥çœ‹æ‰€æœ‰æ¡ç›® |
| `pmux notebook get <id> [--lod]` | æŸ¥çœ‹æŒ‡å®šæ¡ç›® |
| `pmux notebook fold <id>` | æŠ˜å åˆ° Gist |
| `pmux notebook unfold <id>` | å±•å¼€åˆ° Full |
| `pmux notebook summary <id>` | è®¾ç½®ä¸º Summary |
| `pmux notebook list` | åˆ—å‡ºæ‰€æœ‰ ID å’Œæ ‡é¢˜ |
| `pmux notebook stats` | ç»Ÿè®¡ä¿¡æ¯ |
| `pmux notebook tags` | åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾ |
| `pmux notebook filter <tag>` | æŒ‰æ ‡ç­¾ç­›é€‰ |
| `pmux notebook fold-all [level]` | æ‰¹é‡æŠ˜å  |

### æ•°æ®æ¨¡å‹
```csharp
public record ContentNode
{
    public required string Id { get; init; }
    public required string Title { get; init; }
    public required ContentSource Source { get; init; }  // Static | Dynamic | UserInput
    public required LodContent Content { get; init; }
    public LodLevel CurrentLod { get; set; } = LodLevel.Summary;
    public IReadOnlyList<string> Tags { get; init; } = [];
}

public record LodContent
{
    public required string Full { get; init; }
    public string? Summary { get; init; }
    public string? Gist { get; init; }
    
    // è‡ªåŠ¨é™çº§ï¼šGist ä¸ºç©ºæ—¶ç”¨ Summaryï¼ŒSummary ä¸ºç©ºæ—¶ç”¨ Full
    public string GetAtLevel(LodLevel level);
}
```

## 3. Specialist åé¦ˆæ±‡æ€»

### Investigatorï¼ˆä½¿ç”¨åœºæ™¯è§†è§’ï¼‰
**è¯„åˆ†**: â­â­â­â­â­ éå¸¸æœ‰å¸®åŠ©

**æ ¸å¿ƒä»·å€¼**:
- è°ƒæŸ¥å¤šæ¨¡å—æ—¶å¯ä»¥å­˜å‚¨å…³é”®ä¿¡æ¯
- éœ€è¦æ—¶å±•å¼€ï¼Œä¸éœ€è¦æ—¶æŠ˜å æˆä¸€å¥è¯
- è·¨ä¼šè¯è®°å¿†ä¿æŒ

**å»ºè®®**:
- æ‰¹é‡æ“ä½œ: `fold <id1> <id2>`
- å¿«æ·æ–¹å¼: `nb` åˆ«å, `f`/`u` ç®€å†™
- ä¸Šä¸‹æ–‡ä¿å­˜: `save-context`/`load-context`
- å…³è”å…³ç³»: æ¡ç›®é—´é“¾æ¥
- æœç´¢åŠŸèƒ½: å…¨æ–‡æœç´¢

### CodexReviewerï¼ˆä»£ç è´¨é‡è§†è§’ï¼‰
**å‘ç°çš„ Bug**:
1. LOD ç»Ÿè®¡ä¸è§†å›¾è¦†ç›–ä¸ä¸€è‡´ â€” `view --lod full` æ—¶ç»Ÿè®¡ä»æ˜¾ç¤ºåŸå§‹åˆ†å¸ƒ
2. æ ‡ç­¾å¤§å°å†™å¤„ç†ä¸ä¸€è‡´ â€” è¿‡æ»¤ç”¨ OrdinalIgnoreCaseï¼Œç»Ÿè®¡ç”¨é»˜è®¤
3. CLI `--lod` å‚æ•°æ— æ ¡éªŒ â€” æ— æ•ˆå€¼è¢«é™é»˜å¿½ç•¥

**æ¶æ„å»ºè®®**:
- åˆ†ç¦»å†…å®¹ä¸è§†å›¾çŠ¶æ€
- ä¸ºæŒä¹…åŒ–/æœç´¢é¢„ç•™æ¥å£å±‚
- ç»Ÿä¸€æ ‡ç­¾è§„èŒƒåŒ–

### GeminiAdvisorï¼ˆUX åˆ›æ–°è§†è§’ï¼‰
**äº¤äº’è®¾è®¡å»ºè®®**:
1. ä»å‘½ä»¤å¼åˆ°å£°æ˜å¼: `focus [id1, id2]` è‡ªåŠ¨å¤„ç†å…³è”å±•å¼€/æŠ˜å 
2. ç¬¦å· â†’ æ–‡æœ¬æ ‡ç­¾: `[GIST]` æ¯” `â–¶` å¯¹ LLM æ›´å‹å¥½ï¼Œå‡å°‘ token æ­§ä¹‰

**Gist è´¨é‡å»ºè®®**:
- é«˜ç†µ Gist: ä¸æ˜¯"è´­ç‰©æ¸…å•"ï¼Œè€Œæ˜¯"è´­ç‰©æ¸…å• (3é¡¹: é¸¡è›‹, ç‰›å¥¶...)"
- å³ä½¿åœ¨ Gist çº§åˆ«ä¹Ÿé€å‡ºå…³é”®å…ƒæ•°æ®

**åˆ›æ–°åŠŸèƒ½å»ºè®®**:
1. **è¯­ä¹‰é€é•œ**: `expand-by-query "å¦‚ä½•é…ç½® PipeMux"` â€” æŒ‰è¯­ä¹‰ç›¸ä¼¼åº¦å±•å¼€
2. **å¯å†™ Gist**: å…è®¸ Agent ä¿®æ”¹ Gist æè¿°ï¼Œå®ç°"è®°å¿†ç¼–ç "
3. **Scratchpad**: å§‹ç»ˆå¯è§çš„ä¸´æ—¶å·¥ä½œåŒºï¼Œä¸å— LOD æŠ˜å å½±å“

### Implementerï¼ˆå®ç°è§†è§’ï¼‰
**ä¸‹ä¸€æ­¥ä¼˜å…ˆçº§**:
1. ğŸ”´ P0: æŒä¹…åŒ–ï¼ˆå¦åˆ™æ— æ³•çœŸæ­£ä½¿ç”¨ï¼‰
2. ğŸŸ¡ P1: `add` å‘½ä»¤ï¼ˆå®Œæˆå†™å…¥é—­ç¯ï¼‰
3. ğŸŸ¢ P2: æµ‹è¯•è¦†ç›–ï¼ˆModel å±‚å…ˆè¡Œï¼‰

**æŠ€æœ¯å€ºåŠ¡**:
- æ— æŒä¹…åŒ–ï¼ˆæ¯æ¬¡é‡å¯ä¸¢å¤±çŠ¶æ€ï¼‰
- record çš„ mutable å±æ€§ï¼ˆCurrentLodï¼‰
- ç¡¬ç¼–ç  Sample Data

**æµ‹è¯•ç­–ç•¥**:
- Model å±‚å•å…ƒæµ‹è¯•ï¼ˆå¯ç«‹å³å¼€å§‹ï¼‰
- Command å±‚é›†æˆæµ‹è¯•ï¼ˆTestConsole æ•è·è¾“å‡ºï¼‰
- E2E æµ‹è¯•ï¼ˆé€šè¿‡ pmux CLIï¼‰

## 4. ç»¼åˆä¼˜å…ˆçº§æ’åº

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | æ¥æº |
|--------|------|------|
| ğŸ”´ P0 | Bug ä¿®å¤ï¼šç»Ÿè®¡/æ ‡ç­¾/å‚æ•°æ ¡éªŒ | CodexReviewer |
| ğŸ”´ P0 | æŒä¹…åŒ–ï¼ˆsave/loadï¼‰ | Implementer, Investigator |
| ğŸŸ  P1 | `add` / `add-file` å‘½ä»¤ | Implementer |
| ğŸŸ  P1 | å£°æ˜å¼ `focus` å‘½ä»¤ | GeminiAdvisor |
| ğŸŸ¡ P2 | æ‰¹é‡æ“ä½œå¢å¼ºï¼ˆå¤š IDã€æŒ‰æ ‡ç­¾ï¼‰ | Investigator |
| ğŸŸ¡ P2 | æœç´¢åŠŸèƒ½ | Investigator |
| ğŸŸ¢ P3 | å¯å†™ Gist | GeminiAdvisor |
| ğŸŸ¢ P3 | è¯­ä¹‰é€é•œ | GeminiAdvisor |

## 5. è®¾è®¡å†³ç­–è®°å½•

### ä¸ºä»€ä¹ˆé€‰æ‹© Gist/Summary/Full ä¸‰çº§ï¼Ÿ
- ä¸‰çº§æ˜¯å¥½çš„å¹³è¡¡ï¼šçŸ¥é“"æœ‰è¿™ä¸ª" / "å¤§æ¦‚æ˜¯ä»€ä¹ˆ" / "æ‰€æœ‰ç»†èŠ‚"
- é¿å…è¿‡åº¦è®¾è®¡ï¼ˆæ›´å¤šçº§åˆ«å¢åŠ å¤æ‚åº¦ï¼‰
- å¯ä»¥é€šè¿‡ Custom çº§åˆ«æ‰©å±•

### ä¸ºä»€ä¹ˆä½¿ç”¨ `â–¶ â—‰ â–¼` ç¬¦å·ï¼Ÿ
- å¯¹äººç±»ç›´è§‚
- ä½† GeminiAdvisor æŒ‡å‡ºå¯¹ LLM å¯èƒ½ä¸å‹å¥½
- è€ƒè™‘åç»­æ”¹ä¸ºæ–‡æœ¬æ ‡ç­¾ `[GIST]`/`[SUMMARY]`/`[FULL]`

### ä¸ºä»€ä¹ˆå…ˆåšåªè¯»åŸå‹ï¼Ÿ
- å¿«é€ŸéªŒè¯ LOD æ¦‚å¿µ
- é™ä½å®ç°å¤æ‚åº¦
- å…ˆç¡®è®¤æ–¹å‘å†æŠ•å…¥æŒä¹…åŒ–ç­‰é‡åŠŸèƒ½

## 6. åç»­è¿­ä»£è®¡åˆ’

### Phase 1: ä¿®å¤ä¸å®Œå–„ (P0)
- [ ] ä¿®å¤ CodexReviewer å‘ç°çš„ 3 ä¸ª Bug
- [ ] å®ç° save/load æŒä¹…åŒ–

### Phase 2: å†™å…¥èƒ½åŠ› (P1)
- [ ] `add` å‘½ä»¤ï¼ˆæ‰‹åŠ¨æ·»åŠ æ¡ç›®ï¼‰
- [ ] `add-file` å‘½ä»¤ï¼ˆä»æ–‡ä»¶å¯¼å…¥ï¼‰
- [ ] `focus` å‘½ä»¤ï¼ˆå£°æ˜å¼å±•å¼€ï¼‰

### Phase 3: é«˜çº§åŠŸèƒ½ (P2)
- [ ] æœç´¢åŠŸèƒ½
- [ ] æ‰¹é‡æ“ä½œ
- [ ] ä¸Šä¸‹æ–‡ä¿å­˜/æ¢å¤

### Phase 4: åˆ›æ–°æ¢ç´¢ (P3)
- [ ] å¯å†™ Gist
- [ ] è¯­ä¹‰é€é•œ
- [ ] Scratchpad

---

*åˆ›å»ºæ—¥æœŸ: 2025-12-09*
*ä½œè€…: Team Leader (åˆ˜å¾·æ™º)*
