````markdown
# 常规记忆维护技能指南

> 本文档定义 AI Team 成员维护自身记忆文件的标准方法论。
> 适用于：index.md、meta-cognition.md、journal.md 等认知载体文件。
>
> **版本**：1.1
> **日期**：2026-01-01
> **状态**：Published
> **来源**：基于团队记忆维护实践经验
> **维护者**：MemoryPalaceKeeper
>
> **依赖关系**：
> - DependsOn: [accumulate-memory.md]
> - SeeAlso: [organize-deep-maintenance.md, batch-process-inbox.md]

---

## 术语定义

| 术语 | 定义 |
|:-----|:-----|
| **记忆文件** | index.md等认知载体文件 |
| **维护** | 有记录的整理操作（压缩、归档、提纯）|
| **洞见** | 跨时间可复用的知识 |
| **过程记录** | 会议发言、投票等（高衰减）|
| **备份** | 维护前状态快照 |
| **归档** | 迁出主文件的过程材料 |

---

## 概述

### 为什么需要记忆维护？
记忆文件是我们的"大脑"，积累过程记录会导致：
- 核心洞见被淹没
- 唤醒效率下降
- 认知混乱

### 适用信号
- 文件行数>800行
- 过程记录过多影响查找
- 需要提取固化洞见
- 准备知识交接

### 不适用信号
- 文件<300行
- 简单格式整理
- 实时协作中
- 缺乏足够时间

### TL;DR
1. 阈值驱动（>800行）
2. 备份优先
3. 洞见提纯
4. 过程归档
5. 结构优化
6. 质量检查

### 记忆维护的目标

- **移除**：已被新现实覆盖的过时信息
- **压缩**：低后效性的过程性旧记录
- **保留**：形成的经验和知识（误解澄清、深度洞见、方法论）

### 核心隐喻

> 记忆维护 ≈ 人类的睡眠记忆整合
> - 短期记忆（过程讨论）→ 长期记忆（洞见）
> - 遗忘无关细节 → 保留核心要义

---

## 记忆分层框架

### 四层结构

| 层级 | 内容 | 特征 | 唤醒时加载 |
|:-----|:-----|:-----|:-----------|
| **Identity** | 我是谁、擅长什么、怎么工作 | 稳定、极少变化 | ✅ MUST |
| **Insight** | 经验教训、方法论、核心领悟 | 独立可理解、跨项目适用 | ✅ MUST |
| **Index** | 时间线摘要 + 指向详细记录的链接 | 导航性、可快速浏览 | 🔶 SHOULD |
| **Archive** | 完整讨论过程 | 完整但不在主文件 | ❌ 按需 |

### 层级示意图

```
┌─────────────────────────────────────────┐
│  index.md（主记忆文件，唤醒时读取）      │
│  ┌─────────────────────────────────┐    │
│  │ Identity 层 (~50 行)            │    │
│  │ "我是谁、擅长什么"              │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ Insight 层 (~150 行)            │    │
│  │ "我学到了什么、形成了什么经验"   │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ Index 层 (~100 行)              │    │
│  │ "做过什么、在哪里详细讨论过"     │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
           │
           │ 链接
           ▼
┌─────────────────────────────────────────┐
│  Archive（归档目录，仅追溯时读取）       │
│  完整讨论过程、原始发言、详细记录        │
└─────────────────────────────────────────┘
```

### Token 预算建议

> **上下文环境**：当前 Copilot Chat 触发上下文压缩的阈值约为 128K tokens。
> 主记忆文件应控制在合理范围内，为任务上下文留出空间。

| 层级 | 建议行数 | Token 估算 |
|:-----|:---------|:-----------|
| Identity | ~80 行 | ~800 |
| Insight | ~220 行 | ~2200 |
| Index | ~150 行 | ~1500 |
| **主文件总计** | **~450-600 行（建议值）** | **~4500-6000** |

> **弹性说明**：450-600 行是建议值，非硬性下限。
> 经验丰富的成员（参与时间长、洞见密度高）可适当放宽至 700 行。
> 核心原则：**保留所有核心洞见，压缩率服从于洞见完整性**。

**触发维护的阈值**：主文件超过 **800 行**（约 8000 tokens）时 SHOULD 触发维护。

---

## 核心操作：洞见提纯

### 什么是"洞见提纯"？

从过程记录中提取核心洞见，删除承载洞见的冗余叙事，建立指向详细讨论的索引链接。

```
过程记录 → 识别洞见信号 → 提纯到 Insight 层 → 压缩载体为索引 → 归档原始内容
```

### 洞见识别信号

以下模式通常标志着洞见的存在：

- 明确标记："核心洞察"、"关键发现"、"方法论收获"
- 抽象总结：以概念/原则结尾的段落
- 类比应用："这类似于..."、"这是 X 模式的应用"
- 立场转变："修正立场"、"之前认为...现在认为..."
- 经验教训："教训"、"避免"、"下次应该"

### 过时信息识别标准

以下信号表明信息已过时，应移除或更新：

| 信号 | 说明 | 处置 |
|:-----|:-----|:-----|
| **名称已变更** | 旧项目名/旧术语仍在使用 | 更新或移除 |
| **决策已翻转** | 旧决策已被新决策取代 | 保留新决策，归档旧决策 |
| **路径已迁移** | 引用的文件路径不再存在 | 更新链接或移除 |
| **角色已变化** | 旧的团队结构/职责描述 | 更新为当前状态 |
| **时效性表述** | "目前"、"即将"等已过期的表述 | 更新为具体日期或移除 |
| **重复表达** | 同一概念多处表述 | 保留最精炼的一处 |

### 区分标准

#### MUST 保留（概念定义类）

具有以下特征的记录应保留为洞见：

| 特征 | 说明 | 示例 |
|:-----|:-----|:-----|
| **独立可理解** | 不需要上下文就能理解 | "概念层/编码层分离是设计审阅的关键维度" |
| **跨项目适用** | 未来类似场景也有价值 | "Primary Definition + Index 模式" |
| **不可推断** | 不能从其他文档推导出来 | 个人体验的 Dreamer/Clerk 张力 |
| **形成方法论** | 从具体案例上升为抽象经验 | "洞见提纯"操作本身 |

#### SHOULD 压缩（过程讨论类）

具有以下特征的记录应压缩或归档：

| 特征 | 说明 | 示例 |
|:-----|:-----|:-----|
| **依赖上下文** | 需要知道"谁说了什么" | "赞同 GPT 的方案 A" |
| **决策已落定** | 讨论过程价值衰减 | 投票过程的详细记录 |
| **可从他处获取** | 有其他 SSOT | 项目状态、代码位置 |
| **重复表达** | 多次讨论同一概念 | 选择最精炼的一次 |

### 压缩模式示例

**压缩示例**：
- 压缩前：150行详细讨论
- 压缩后：5行索引条目
- 格式：`> **YYYY-MM-DD 主题**（N轮）角色：XXX | 产出：XXX → [详细讨论](链接)`

---

## 维护触发条件

### 阈值驱动
- 行数 > 800：SHOULD触发维护
- 行数 > 600且连续2周增长：趋势预警
- 近7天新增 > 200行：增长率异常

### 事件驱动
- 项目/组件重大更名：MUST维护
- 目录结构大迁移：MUST维护
- 团队协议变更：SHOULD维护

### 周期驱动
- 每30天：SHOULD执行维护检查

---

## 维护流程 SOP

### 速查清单

```markdown
## 记忆维护速查清单

### 准备阶段
□ 确定维护范围（哪些文件）
□ 创建备份（Git commit 或 archive 快照）
□ 列出"不可删除清单"（Non-Negotiables）

### 执行阶段
□ 分类：Identity / Insight / Index / Archive
□ 洞见提纯：先提取再压缩
□ 过程记录压缩为索引条目
□ 过时信息标记 deprecated 或移除
□ 断链内容留 stub 重定向

### 验收阶段
□ 冷启动测试：读完能理解"我是谁"
□ 链接可达性检查
□ 写入维护日志
```

### 核心操作要点 `[MAINTAIN-07]`

#### 1. 准备阶段要点
- **确定范围**：明确维护哪些记忆文件 `[MAINTAIN-07-01]`
- **创建备份**：Git commit或Archive快照 `[MAINTAIN-07-02]`
- **列出不可删除项**：核心洞见、生效决策、外部引用锚点 `[MAINTAIN-07-03]`

#### 2. 执行阶段要点 `[MAINTAIN-08]`
- **分类扫描**：使用`[I]`(Identity)、`[S]`(Insight)、`[X]`(Index)、`[A]`(Archive)标记 `[MAINTAIN-08-01]`
- **洞见提纯**：从Index中提取跨时间可复用的知识到Insight层 `[MAINTAIN-08-02]`
- **过程压缩**：将过程记录压缩为索引条目 `[MAINTAIN-08-03]`
- **过时处理**：过时信息标记deprecated或移除 `[MAINTAIN-08-04]`

#### 3. 验收阶段

**3.1 冷启动测试**

把自己当作首次激活的 Agent，检查：
- 读完 Identity+Insight 能否理解"我能提供什么价值"？
- 能否在 30 秒内找到"最近在做什么"的索引入口？

**3.2 链接可达性**

对本次修改涉及的链接，检查是否可达。

**3.3 写入维护日志**

---

## 维护日志

### 日志位置

> **[决议]** 维护日志位于成员级 `agent-team/members/<name>/maintenance-log.md`
> - 理由：信息局部性、避免多成员并发冲突
> - 跨成员检索：团队级索引 `agent-team/archive/memory-maintenance/index.md`

### 日志格式

**简化版**（日常使用）：

```markdown
## YYYY-MM-DD 维护记录

- **执行者**：<name>
- **范围**：index.md
- **触发原因**：行数 > 500
- **变更摘要**：
  - 提纯洞见 3 条
  - 压缩过程记录 12 块 → 索引条目
  - 归档详细讨论到 archive/
- **备份**：`git commit abc123`
- **QA 结果**：冷启动测试通过
```

**完整版**（重大维护时使用YAML格式）：包含执行者、时间、范围、触发原因、操作、备份、QA结果等字段。

---

## 归档策略

### 归档位置
归档目录：`agent-team/archive/members/<name>/YYYY-MM/`
- 理由：归档是团队资产，集中管理便于检索
- 成员级只放索引链接

### 归档组织方式
按**主题**组织，而非按日期。
- 命名：`<topic>-<date-range>.md`
- 示例：`statejournal-reviews-12-16-to-12-21.md`

### 归档内容要求
- 完整保留原始讨论
- 添加元数据头（来源、日期、原因）
- 保持可追溯性

---

## 质量保障

### 验收标准
维护后必须满足：
- Identity 可读（≤80行，清晰回答"我是谁"）
- 核心洞见可定位（≥5条有明确标题）
- 导航可达（能找到最近3次关键参与链接）
- 结构完整（四层结构都有内容）

### 防过度压缩
- 删除前先提纯洞见
- 关键洞见保留证据链接
- 压缩不引入新含义
- 发现"重新解释历史"时停止

### 变更记录
维护日志必须包含：新增洞见数、压缩块数、归档块数

---

## 规范条款索引

### 核心 MUST 条款
| ID | 条款 | 说明 |
|:---|:-----|:-----|
| [MM-SAFE-BACKUP-REQUIRED] | 维护前创建备份 | Git commit或快照 |
| [MM-PROC-EXTRACT-FIRST] | 删除前先提纯洞见 | 避免丢失知识 |
| [MM-AUDIT-LOG-LOCATION] | 维护后写入日志 | 可追溯性 |
| [MM-ANTI-NO-SEMANTIC] | 压缩不引入新含义 | 只复述不改立场 |
| [MM-QA-INVARIANTS] | 满足认知不变量 | Identity/Insight/Navigation |

### 核心 SHOULD 条款
| ID | 条款 | 说明 |
|:---|:-----|:-----|
| [MM-TRIG-LINES] | 行数 > 800触发维护 | 阈值触发 |
| [MM-PROC-ARCHIVE] | 可回溯内容归档 | 保留追溯能力 |
| [MM-QA-COLDSTART] | 执行冷启动测试 | 验证可读性 |
| [MM-QA-LINKS] | 检查链接可达性 | 避免断链 |

---

## 附录 A：核心条款要点

> 完整条款体系采用 `[MM-<TOPIC>-<KEY>]` 命名体系

**关键条款**：
- **[MM-TRIG-LINES]** SHOULD：行数 > 800 时触发维护
- **[MM-SAFE-BACKUP-REQUIRED]** MUST：维护前创建备份
- **[MM-PROC-EXTRACT-FIRST]** MUST：删除前先提纯洞见
- **[MM-AUDIT-LOG-LOCATION]** MUST：维护后写入日志
- **[MM-QA-INVARIANTS]** MUST：满足认知不变量
- **[MM-ANTI-NO-SEMANTIC]** MUST：压缩不引入新含义

> 完整条款列表见独立规范文件

---

## 附录 B：记忆文件目标结构模板

```markdown
# <Name> — 认知入口

> **身份**: <角色描述>
> **驱动模型**: <模型名称>
> **首次激活**: <日期>

---

## 身份简介（Identity）

（我是谁，约 30 行）

---

## 专长领域（Identity）

（我擅长什么，约 20 行）

---

## 核心洞见（Insight）

### 方法论
- <方法论 1>
- <方法论 2>
- ...

### 经验教训
- <教训 1>
- <教训 2>
- ...

### 重要决策参与
（精选 3-5 个最重要的，其他放 Index）

---

## 参与历史索引（Index）

| 日期 | 主题 | 角色 | 关键产出 | 详细记录 |
|:-----|:-----|:-----|:---------|:---------|
| 2025-12-20 | MVP v2 审阅 | 概念框架 | 14 项问题 | [链接] |
| ... | ... | ... | ... | ... |

---

## 认知文件结构

（文件组织说明，约 10 行）

---

## 最后更新

**YYYY-MM-DD** — 最近一次重要活动的简要描述
```

---

## 附录 C：决议记录

> 以下决议由 2025-12-22 畅谈会确定

### 决议要点

**#1 维护日志位置**：成员级 `agent-team/members/<name>/maintenance-log.md`
- 理由：信息局部性，避免并发冲突

**#2 归档目录结构**：团队级 `agent-team/archive/members/<name>/YYYY-MM/`
- 理由：归档是团队资产，集中管理

**#3 条款体系**：保持现状，优先修复一致性
- 速查表是附录A的子集视图
- 条款ID必须一致

---

## 变更日志

| 日期 | 版本 | 变更 |
|:-----|:-----|:-----|
| 2025-12-22 | v1.0 | 正式版，根据畅谈会第二轮审阅修订：<br>- 解决 3 个 Open Questions<br>- 添加术语定义区<br>- 放宽 Token 预算（150%）<br>- 统一条款 ID 一致性<br>- 添加 append-only 约束<br>- 更新路径为完整路径 |
| 2025-12-22 | v0.1 | 初稿，基于畅谈会第一轮讨论成果 |

````