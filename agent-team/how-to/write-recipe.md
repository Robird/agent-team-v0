# Recipe 元Recipe（草案）

> **版本**：0.1  
> **日期**：2026-01-01  
> **状态**：Draft  
> **来源**：[畅谈会：什么是好的Recipe文档？](../meeting/2026-01-01-recipe-meta-discussion.md)  
> **维护者**：DocOps  
>
> **依赖关系**：
> - DependsOn: 无（这是元Recipe）
> - SeeAlso: [所有现有Recipe](../how-to/)

---

## 适用信号

当你需要：
- 编写新的Recipe文档
- 修订现有Recipe文档
- 评估Recipe文档质量
- 理解Recipe在整个文档体系中的定位

## 不适用信号

如果你：
- 需要具体的操作指导（请查阅相关Recipe）
- 需要了解团队规范（请查阅specs/）
- 需要追溯历史讨论（请查阅meeting/）

## TL;DR

1. **Recipe是"决策压缩器"**：把成功经验转化为可复用的"如果…则…"规则
2. **控制篇幅**：理想长度200-500行，超过600行考虑拆分
3. **30秒可判性**：开篇必须让读者快速判断相关性
4. **渐进式披露**：信息按需展开（速读→操作→理解）
5. **可审计证据链**：条款ID、引用关系、版本管理必须清晰

---

## 一、Recipe是什么？不是什么？

### Recipe是...

**面向重复执行的决策压缩器**（Seeker定义）：
- 把"摸索试错"变成"按图索骥"
- 聚焦"下次该怎么做"，而非"发生了什么"
- 语气是"当你遇到X时，考虑Y"，而非"你必须做X"

### Recipe不是...

| 不是 | 为什么 | 对应物 |
|:-----|:-------|:-------|
| **过程回顾** | 回顾关注"发生了什么"，Recipe关注"下次怎么做" | Meeting记录 |
| **规范条款** | 规范是约束（必须遵守），Recipe是建议（推荐采用） | spec.md |
| **术语表** | 术语定义"是什么"，Recipe定义"怎么做" | glossary |
| **任务清单** | 清单列出"要完成的事项"，Recipe提供"完成的方法" | todo.md |

---

## 二、好Recipe的五个核心特征

### 特征1：情境锚定（Situation-Anchored）
> **原则**：Recipe必须明确回答"什么时候用这个？"

**检验方法**：读者能否在30秒内判断"这个Recipe与我当前情境相关吗？"

**实现要求**：
- 开篇必须有"适用信号"和"不适用信号"章节
- 使用具体情境描述，而非抽象原则

### 特征2：决策导向（Decision-Oriented）
> **原则**：Recipe的核心内容应该是**选择点**和**选择依据**

**检验方法**：能否从Recipe中提取出"如果…则…"的决策规则？

**实现要求**：
- 使用决策表格、流程图、决策树等可视化工具
- 明确标注不同情境下的推荐做法

### 特征3：可操作粒度（Actionable Granularity）
> **原则**：步骤分解到"执行者知道下一步做什么"的粒度

**检验方法**：新手读完后能否立即开始执行？

**实现要求**：
- 提供最小可执行示例
- 步骤有明确的输入和输出定义
- 避免过于抽象或过于细碎

### 特征4：适度弹性（Appropriate Flexibility）
> **原则**：区分MUST（不可违反的约束）和SHOULD/MAY（推荐但可调整的建议）

**检验方法**：Recipe是否标注了哪些是硬约束、哪些是可调整的？

**实现要求**：
- 使用MUST/SHOULD/MAY标签
- 为合理变通留出空间
- 说明变通的边界条件

### 特征5：篇幅纪律（Length Discipline）
> **原则**：Recipe的长度应与**决策复杂度**成正比，而非与**历史积累**成正比

**检验方法**：删除任意一节后，Recipe的核心指导能力是否受损？

**实现要求**：
- 理想长度：200-500行
- 超过600行：考虑拆分
- 定期压缩历史案例和边缘情况

---

## 三、Recipe结构模板

```markdown
# [Recipe名称]

> **一句话定位**：[解决什么问题，面向谁]
> **版本**：0.1
> **日期**：YYYY-MM-DD
> **状态**：Draft | Pilot | Published | Deprecated
> **来源**：[来源Meeting/讨论]
> **维护者**：[责任人]
>
> **依赖关系**：
> - DependsOn: [前置Recipe列表]
> - SeeAlso: [相关Recipe列表]
> - ReplacedBy: [替代Recipe] (仅Deprecated状态)

---

## 适用信号

当你遇到以下情况时，本Recipe可能有帮助：
- [情境A]
- [情境B]

## 不适用信号

如果你处于以下情况，请查阅其他资源：
- [情境C] → 请看[其他文档]

## TL;DR

<!-- 3-5句话，足以让急迫的读者开始行动 -->
1. [核心要点1]
2. [核心要点2]
3. [核心要点3]

---

## 核心流程

<!-- 选择适合的形式：决策树 / 步骤列表 / 流程图 -->

[流程内容]

## 详细说明

### 步骤1: ...
### 步骤2: ...

## 检查清单

- [ ] 检查项1
- [ ] 检查项2

## 常见陷阱

| 陷阱 | 症状 | 解法 |
|:-----|:-----|:-----|
| [TODO] | [TODO] | [TODO] |

## 延伸阅读

- [相关Recipe](./xxx.md)

---

## 更新历史

| 日期 | 版本 | 变更 | 变更类型 |
|:-----|:-----|:-----|:---------|
| YYYY-MM-DD | 0.1 | 初版创建 | MAJOR |
```

---

## 四、质量门禁与审查流程

### 4.1 发布门禁（L0/L1检查）

**L0：结构门禁（机械可判定）**
- [ ] 头部元信息齐全：版本/日期/状态/来源/维护者
- [ ] 首屏具备：适用信号 + 不适用信号 + TL;DR
- [ ] 存在"检查清单"章节
- [ ] 存在"更新历史"章节
- [ ] 全文链接无死链

**L1：规范门禁（半自动+人审）**
- [ ] 存在MUST/SHOULD/MAY时：每条MUST有条款ID（`[XX-YY-ZZ]`）
- [ ] 条款ID唯一、未复用、未改名
- [ ] 若引用外部spec条款：给出specRef（文件+版本/commit）

### 4.2 审查流程

```
作者提交Recipe草案
    ↓
DocOps执行L0检查（自动化脚本）
    ↓
Craftsman执行L1审查（人工）
    ↓
状态标记：Draft → Pilot
    ↓
至少一次真实执行验证
    ↓
状态标记：Pilot → Published
```

### 4.3 版本管理

| 变更类型 | 版本影响 | 兼容性要求 |
|:---------|:---------|:-----------|
| **补充说明** | PATCH (+0.0.1) | 完全兼容 |
| **流程微调** | MINOR (+0.1.0) | 旧做法仍可用 |
| **核心重写** | MAJOR (+1.0.0) | 需迁移指引 |
| **拆分/合并** | 新文件v1.0 + 旧文件Deprecated | ReplacedBy指针 |

---

## 五、Recipe在文档体系中的定位

### 5.1 文档类型关系

```
                    ┌─────────────────┐
                    │  AGENTS.md      │
                    │  (团队入口)     │
                    └────────┬────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
        ▼                    ▼                    ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   wiki/       │   │   how-to/     │   │   meeting/    │
│  (知识库)     │   │  (操作手册)   │   │  (过程记录)   │
│ "是什么"      │   │ "怎么做"      │   │ "发生了什么"  │
└───────┬───────┘   └───────┬───────┘   └───────┬───────┘
        │                   │                   │
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   specs/      │   │   members/    │   │   handoffs/   │
│  (约束条款)   │   │  (私有记忆)   │   │  (交接文档)   │
└───────────────┘   └───────────────┘   └───────────────┘
```

### 5.2 Recipe索引要求

所有Recipe必须在`AGENTS.md中的操作指南速查章节`中注册：

```markdown
# Recipe索引

## 按使用场景

### 🚀 冷启动场景
| Recipe | 状态 | 前置依赖 | 简介 |
|:-------|:-----|:---------|:-----|
| [外部记忆维护](external-memory-maintenance.md) | ✅ | 无 | 记忆文件六种类型元模型 |

### 📝 日常操作场景
| Recipe | 状态 | 前置依赖 | 简介 |
|:-------|:-----|:---------|:-----|
| [记忆积累规范](memory-accumulation-spec.md) | ✅ | 外部记忆维护 | 三步Memory Commit协议 |
```

---

## 六、实施路线图

### Phase 0：基础设施（8小时）
1. 创建`check-recipe-quality.sh`脚本（Implementer）
2. 创建`templates/recipe-template.md`（DocOps）
3. 创建`AGENTS.md中的操作指南速查章节`索引（DocOps）

### Phase 1：结构对齐（16小时）
1. 为12个现有Recipe添加缺失章节（DocOps为主）
2. 统一版本格式和元信息
3. 建立依赖关系声明

### Phase 2：深度优化（持续）
1. 拆分过长Recipe（>600行）
2. 建立定期审计机制（每月1次）
3. 集成到Changefeed系统

---

## 七、实施决策变更记录

> **记录日期**: 2026-01-01  
> **决策背景**: 基于监护人建议，优化Token使用效率，避免信息重复注入

### 未实施的P0行动（原计划）

| 原计划行动 | 变更原因 | 新方案 |
|:-----------|:---------|:-------|
| 目录上移到根目录（`agent-te../how-to/` → `/how-to/`） | 避免workspace_info和AGENTS.md重复注入相同信息 | 仅改名不上移（`agent-te../how-to/` → `agent-team/how-to/`） |
| 创建独立的`AGENTS.md中的操作指南速查章节`索引文件 | AGENTS.md已提供完整索引，避免重复维护 | 在AGENTS.md中嵌入极简Prompt化索引 |
| 复杂的Prompt化索引格式（含emoji、markdown链接、星号） | 优化Token使用效率 | 极简格式：`情境问句？ → \`文件路径\`` |

### 新的索引方案

**位置**: AGENTS.md中的"操作指南速查"章节  
**格式**: 极简Prompt化索引

```markdown
## 操作指南速查

需要命名？ → `how-to/name-things-well.md`
整理记忆？ → `how-to/maintain-memory.md`
记录洞见？ → `how-to/accumulate-memory.md`
主持畅谈会？ → `how-to/run-jam-session.md`
代码审阅？ → `how-to/review-code-with-spec.md`
拆分测试？ → `how-to/split-test-files.md`
编写指南？ → `how-to/write-recipe.md`
生成Beacon？ → `how-to/generate-beacon.md`
```

**Token优化**: 从原方案~375 tokens降至~150 tokens，节省约60%

### 迭代路径

如果当前方案效果不足，可考虑：
1. **Phase 2**: 将`agent-team/how-to/`上移到根目录`/how-to/`
2. **Phase 3**: 根据workspace_info实际展示情况进一步优化

---

## 八、本Recipe的自审检查清单

> **注意**：作为元Recipe，本文件必须首先通过自己定义的质量标准。

### 结构完整性检查（L0）
- [x] 头部元信息齐全：版本/日期/状态/来源/维护者
- [x] 首屏具备：适用信号 + 不适用信号 + TL;DR
- [x] 存在"检查清单"章节（本节）
- [x] 存在"更新历史"章节
- [ ] 全文链接无死链（待验证）

### 规范一致性检查（L1）
- [x] 存在MUST/SHOULD/MAY时：每条MUST有条款ID
- [x] 条款ID唯一、未复用、未改名
- [x] 若引用外部spec条款：给出specRef

### 内容质量检查
- [x] **情境锚定**：开篇明确适用/不适用信号
- [x] **决策导向**：提供"如果…则…"规则（如版本管理策略）
- [x] **可操作粒度**：提供具体实施路线图
- [x] **适度弹性**：区分MUST/SHOULD/MAY
- [x] **篇幅纪律**：当前长度~300行，符合200-500行标准

## 八、常见问题

### Q1：Recipe和System Prompt的关系是什么？
**A**：Recipe是**设计理念库**（解释为什么这样设计），System Prompt是**执行压缩版**（告诉执行者怎么做）。两者是"深度解释 vs 快速参考"的关系。

### Q2：Recipe应该多长？
**A**：理想长度200-500行。超过600行应考虑拆分。长度应与决策复杂度成正比，而非历史积累。

### Q3：如何判断Recipe是否需要修订？
**A**：触发条件：
- 执行时发现规则与实践脱节
- 同类问题重复出现
- 篇幅超过类型建议上限
- 新方法被验证有效

### Q4：Recipe废弃后如何处理？
**A**：
1. 状态标记为Deprecated
2. 添加ReplacedBy字段指向新Recipe
3. 索引中标记⚠️
4. **不删除文件**（保持历史记录）

### Q5：元Recipe是否需要豁免某些规则？
**A**：**不需要豁免**。元Recipe必须首先通过自己定义的所有质量标准，这是"自我一致性"的基本要求。如果发现规则冲突，应修订规则而非创建例外。

---

## 更新历史

| 日期 | 版本 | 变更 | 变更类型 |
|:-----|:-----|:-----|:---------|
| 2026-01-01 | 0.1 | 初版创建，基于畅谈会讨论 | MAJOR |
```

---

*本文件是元Recipe草案，欢迎在畅谈会中讨论修订。*