# Task Board - DurableHeap MVP v2 æ–‡æ¡£ä¿®è®¢

> **æ¥æº**: 2025-12-19 ç§˜å¯†åŸºåœ°ç•…è°ˆä¼šå…±è¯†
> **å†³ç­–è®°å½•**: [`meeting/2025-12-19-secret-base-durableheap-mvp-v2-review.md`](meeting/2025-12-19-secret-base-durableheap-mvp-v2-review.md)
> **ç›‘æŠ¤äººæ‰¹ç¤º**: 2025-12-19 âœ… æ‰¹å‡†æ‰§è¡Œ

**ç›®æ ‡æ–‡æ¡£**: `DurableHeap/docs/mvp-design-v2.md`

---

## ç›‘æŠ¤äººæ‰¹ç¤ºè¦ç‚¹

1. **"Re-set to Update" é™·é˜±æ˜¯ä¼ªé—®é¢˜** â€” MVP ä»…æ”¯æŒæ•´æ•°å’Œ DurableDict ä½œä¸ºæˆå‘˜ï¼Œåç»­ä¹Ÿåªæ”¯æŒåŸºå…ƒç±»å‹å’Œ DurableObject æ´¾ç”Ÿçš„å®¹å™¨ç±»å‹ï¼Œä¸å­˜åœ¨ç”¨æˆ·ä¿®æ”¹å¼•ç”¨ç±»å‹å†…éƒ¨çŠ¶æ€çš„åœºæ™¯ã€‚

2. **æ–‡æ¡£åŸåˆ™**ï¼š
   - é¦–å…ˆå‘ˆç° **What**
   - åœ¨å…³é”®ä¹‹å¤„è®°å½•å°‘é‡ **Why** ç”¨äºé”å®šå†³ç­–
   - å·²è¢«è¦†ç›–çš„æ—§ä¿¡æ¯åº”**ç§»é™¤**ï¼ˆæœ‰ git å†å²å¯æŸ¥ï¼Œæ— éœ€ä¸“é—¨ä¿ç•™ï¼‰

3. **ç›®æ ‡**ï¼šç¼©å‡æ–‡æ¡£è§„æ¨¡ï¼Œæé«˜ä¸€è‡´æ€§

---

## ğŸ”´ Critical â€” å‘å¸ƒå‰å¿…é¡»å®Œæˆ

| ID | ä»»åŠ¡ | è´£ä»» | é¢„è®¡å·¥æ—¶ | Status |
|----|------|------|----------|--------|
| A-1 | ä¿®æ”¹ 4.4.4 ä¼ªä»£ç ï¼š`FlushToWriter` â†’ äºŒé˜¶æ®µæ‹†åˆ† (Prepare/Finalize) | Implementer | 30 min | â³ å¾…è®¤é¢† |
| A-2 | ä¿®æ”¹ 4.4.5 Commit æµç¨‹ï¼šå¢åŠ  finalize è§„èŒƒçº¦æŸ | Implementer | 15 min | â³ å¾…è®¤é¢† |
| A-3 | å…¨æ–‡æ›¿æ¢ `EpochRecord` â†’ `Commit Record` | DocOps | 20 min | â³ å¾…è®¤é¢† |
| A-4 | å…¨æ–‡æ›¿æ¢ `EpochMap` â†’ `VersionIndex` | DocOps | 10 min | â³ å¾…è®¤é¢† |

### A-1/A-2 è¯¦ç»†è§„æ ¼

**äºŒé˜¶æ®µæ‹†åˆ†è¯­ä¹‰**ï¼š

| é˜¶æ®µ | API åç§° | èŒè´£ | çŠ¶æ€å˜åŒ– |
|------|----------|------|----------|
| **Prepare** | `WritePendingDiff(writer)` | åºåˆ—åŒ– diff â†’ å†™å…¥ data file | æ— ï¼ˆä¿æŒ dirtyï¼‰ |
| **Finalize** | `OnCommitSucceeded()` | è¿½å¹³å†…å­˜çŠ¶æ€ | `_committed = _current`, `_isDirty = false` |

**è§„èŒƒçº¦æŸ**ï¼š
> å¯¹è±¡çº§å†™å…¥ä¸å¾—æ”¹å˜ Committed/Dirty çŠ¶æ€ï¼›åªæœ‰ heap çº§ commit æˆåŠŸæ‰èƒ½ finalizeã€‚

---

## ğŸŸ  Major â€” å»ºè®®å‘å¸ƒå‰å®Œæˆ

| ID | ä»»åŠ¡ | è´£ä»» | é¢„è®¡å·¥æ—¶ | Status |
|----|------|------|----------|--------|
| B-1 | æœ¯è¯­è¡¨ï¼šæ–°å¢"ç¼–ç å±‚"åˆ†ç»„ï¼Œæ”¶å½• `RecordKind`/`ObjectKind` | DocOps | 15 min | â³ å¾…è®¤é¢† |
| B-2 | æœ¯è¯­è¡¨ï¼šæ–°å¢ `EpochSeq` æ¡ç›® | DocOps | 5 min | â³ å¾…è®¤é¢† |
| B-3 | ç»Ÿä¸€ `RecordKind`/`MetaKind` å‘½åï¼ˆåºŸå¼ƒ `MetaKind`ï¼‰ | Implementer | 20 min | â³ å¾…è®¤é¢† |
| B-4 | ä¿®å¤ Markdown ç›¸å¯¹é“¾æ¥ï¼ˆÂ§6 çš„ ChunkedReservableWriter.csï¼‰ | DocOps | 5 min | â³ å¾…è®¤é¢† |
| B-5 | Q11 ç§»é™¤ A çš„"ï¼ˆæ¨èï¼‰"æ ‡è®°ï¼Œæˆ–è¡¥å……ç†ç”± | DocOps | 5 min | â³ å¾…è®¤é¢† |
| B-6 | æ–°å¢"ç±»å‹çº¦æŸ"ç« èŠ‚ï¼šæ˜ç¡®æ”¯æŒçš„å€¼ç±»å‹/å¼•ç”¨ç±»å‹è¾¹ç•Œ | Implementer | 20 min | â³ å¾…è®¤é¢† |

> **B-6 è¯´æ˜**ï¼šæ ¹æ®ç›‘æŠ¤äººè¡¥å……æ‰¹ç¤ºï¼Œæ–‡æ¡£åº”æ˜¾å¼å£°æ˜ DurableHeap çš„ç±»å‹çº¦æŸâ€”â€”è¿™æ˜¯è®¾è®¡è¾¹ç•Œï¼Œä¸æ˜¯é™·é˜±ã€‚

### B-1 æœ¯è¯­è¡¨æ‰©å±•è§„æ ¼

æ–°å¢ **"ç¼–ç å±‚"** åˆ†ç»„ï¼š

| æœ¯è¯­ | å®šä¹‰ | å¤‡æ³¨ |
|------|------|------|
| `RecordKind` | Record çš„é¡¶å±‚ç±»å‹æ ‡è¯†ï¼Œå†³å®š payload è§£ç æ–¹å¼ | framing å±‚æ¦‚å¿µ |
| `ObjectKind` | ObjectVersionRecord å†…çš„å¯¹è±¡ç±»å‹æ ‡è¯†ï¼Œå†³å®š diff è§£ç å™¨ | payload å±‚æ¦‚å¿µ |

### B-3 RecordKind ç»Ÿä¸€è§„æ ¼

- `RecordKind` ç»Ÿä¸€é¡¶å±‚åˆ¤åˆ«ï¼Œ`ObjectKind` ç»Ÿä¸€å¯¹è±¡çº§ codec åˆ¤åˆ«
- åºŸå¼ƒ `MetaKind`ï¼Œæ”¹ç”¨"Meta file çš„ RecordKind è¡¨"/"Data file çš„ RecordKind è¡¨"è¡¨è¿°
- **å‘½åçº¦å®š**ï¼š"Kind" åªç”¨äºåˆ¤åˆ«å­—æ®µï¼ŒåŒä¸€å±‚ä¸å…è®¸åŒä¹‰ä¸åŒå

### B-6 ç±»å‹çº¦æŸè§„æ ¼

**ç›®æ ‡**ï¼šåœ¨æ–‡æ¡£ä¸­æ˜¾å¼å£°æ˜ DurableHeap **ä¸æ˜¯é€šç”¨åºåˆ—åŒ–åº“**ï¼Œè€Œæ˜¯æœ‰æ˜ç¡®ç±»å‹è¾¹ç•Œçš„æŒä¹…åŒ–æ¡†æ¶ã€‚

**å»ºè®®æ–°å¢ç« èŠ‚ä½ç½®**ï¼š4.1 æ¦‚å¿µæ¨¡å‹ä¹‹åï¼Œæˆ–ä½œä¸º 4.1.4 å­èŠ‚

**å†…å®¹è¦ç‚¹**ï¼š

| ç±»åˆ« | æ”¯æŒ | ä¸æ”¯æŒ |
|------|------|--------|
| **å€¼ç±»å‹** | åŸºå…ƒç±»å‹ï¼š`int`, `long`, `ulong`, `float`, `double`, `bool`, `null` | ä»»æ„ structã€ç”¨æˆ·è‡ªå®šä¹‰å€¼ç±»å‹ |
| **å¼•ç”¨ç±»å‹** | `DurableObject` æ´¾ç”Ÿç±»å‹ï¼ˆå†…ç½®é›†åˆï¼š`DurableDict`, æœªæ¥: `DurableArray`ï¼‰ | ä»»æ„ classã€`List<T>`ã€`Dictionary<K,V>` ç­‰ |

**è¿è¡Œæ—¶è¡Œä¸º**ï¼š
- èµ‹å€¼ä¸æ”¯æŒç±»å‹æ—¶ï¼Œåº”æŠ›å‡ºæ˜ç¡®å¼‚å¸¸ï¼ˆFail-fastï¼‰
- å¯é€‰ï¼šç¼–è¯‘æ—¶é€šè¿‡æ³›å‹çº¦æŸæˆ– Analyzer æå‰æ‹¦æˆª

---

## ğŸŸ¢ Minor â€” å¯å»¶è¿Ÿ

| ID | ä»»åŠ¡ | è´£ä»» | Status |
|----|------|------|--------|
| C-1 | å…¨æ–‡ grep `HEAD`/`head` å¤§å°å†™ä¸€è‡´æ€§ | DocOps | â³ å»¶è¿Ÿ |
| C-2 | `Address64`/`Ptr64` åˆ†å±‚è´¯å½» | DocOps | â³ å»¶è¿Ÿ |
| C-3 | ç»Ÿä¸€ `CRC32C(u32 LE)` è¡¨è¿° | DocOps | â³ å»¶è¿Ÿ |

---

## ğŸ“‹ å·²ç§»é™¤/é™çº§çš„ä»»åŠ¡

| åŸ ID | ä»»åŠ¡ | åŸå›  |
|-------|------|------|
| M-4 | "Re-set to Update" é™·é˜±æ–‡æ¡£åŒ– | ç›‘æŠ¤äººæ‰¹ç¤ºï¼šMVP ç±»å‹é™åˆ¶ä½¿å…¶æˆä¸ºä¼ªé—®é¢˜ |
| B-6 | å¢åŠ å˜æ›´å¥‘çº¦è­¦å‘Šå— | åŒä¸Š |

---

## References

- **ç•…è°ˆä¼šè®°å½•**: [`meeting/2025-12-19-secret-base-durableheap-mvp-v2-review.md`](meeting/2025-12-19-secret-base-durableheap-mvp-v2-review.md)
- **ç›®æ ‡æ–‡æ¡£**: [`DurableHeap/docs/mvp-design-v2.md`](../DurableHeap/docs/mvp-design-v2.md)
- **å†å²å½’æ¡£**: [`archive/task-board-v9-sprint05-archive.md`](archive/task-board-v9-sprint05-archive.md)

---

_Last updated: 2025-12-19_
