# 畅谈会：确定 "2+N" 框架中的 N

> **日期**：2025-12-24
> **标签**：#design
> **主持人**：刘德智 (Team Leader)
> **参与者**：Advisor-Claude, Advisor-Gemini, Advisor-GPT
> **状态**：已完成
> **前序会议**：[LLM 友好的信息表示形式](2025-12-24-llm-friendly-notation.md) ([摘要](2025-12-24-llm-friendly-notation-summary.md))

---

## 背景

前序畅谈会达成了核心共识，监护人将其精简为 **"2+N" 框架**：

### 2 条核心原则（已确定）

1. **SHOULD NOT 使用 ASCII art**
   - 非 MUST NOT，允许创作时先自由表达
   - 正式文档定稿前应转换为更结构化的形式

2. **避免双写**
   - 一份信息尽量只用一种形式表达
   - 避免 SSOT 漂移

### N 条形式选择指导（本次会议目标）

本次会议的目标是：

1. **确定 N 的全集**：我们需要表达哪些类型的结构化信息？
2. **初步分类**：每种类型的推荐表示形式是什么？
3. **输出**：形成可写入 `spec-conventions.md` 的条款草案

---

## 💬 畅谈记录

### 主持人开场 (刘德智)

各位顾问，我们今天的任务很具体：**确定 N 的范围**。

监护人的指导是：先确定我们实际需要使用的图表类型集合，每种的适用条件边界可以后续再细化。

我先抛砖引玉，列出我观察到的 Atelia 文档中常见的结构化信息类型：

#### 候选的 N（图表/结构类型全集）

| # | 类型 | 示例场景 | 当前常用形式 |
|---|------|----------|--------------|
| 1 | **状态机** | StateJournal 的 Page 状态 | Mermaid stateDiagram |
| 2 | **流程图** | 任务执行流程 | Mermaid flowchart |
| 3 | **时序图** | API 调用序列 | Mermaid sequence |
| 4 | **依赖图** | 模块依赖关系 | Mermaid graph |
| 5 | **目录树** | 项目结构 | ASCII tree / 缩进列表 |
| 6 | **位布局** | FrameTag 结构 | ASCII 框图 + 表格 |
| 7 | **二维表格** | 字段定义、枚举值 | Markdown table |
| 8 | **层级列表** | 任务分解、概念层次 | 嵌套列表 |
| 9 | **对比矩阵** | 方案比较、tradeoff | Markdown table |
| 10 | **类图/ER图** | 数据模型 | Mermaid classDiagram |

#### 问题

1. 这个列表是否完整？有遗漏吗？
2. 哪些是 Atelia 项目**实际高频使用**的？（我们不需要覆盖全部，只需要覆盖实际用到的）
3. 每种类型的推荐形式是什么？

请各位发表看法。建议顺序：Claude（概念分类） → Gemini（体验视角） → GPT（条款收敛）

---

### Advisor-Claude 发言

感谢主持人的开场。我来从概念分类的角度审视这个列表。

---

## 一、概念框架：信息结构的本质分类

如果我们退一步看，这 10 种类型背后表达的是什么？我认为可以用一个更底层的框架来组织它们。

### 1.1 信息结构的三个基本维度

| 维度 | 问题 | 可能的值 |
|:-----|:-----|:---------|
| **节点类型** | 节点是什么？ | 状态 / 实体 / 事件 / 概念 / 文件 |
| **关系类型** | 节点之间是什么关系？ | 转换 / 依赖 / 包含 / 对比 / 时序 |
| **拓扑形状** | 关系形成什么结构？ | 树 / 图 / 序列 / 矩阵 / 无关系（集合） |

### 1.2 重新映射候选列表

用这个框架重新审视主持人的 10 种类型：

| 原类型 | 节点类型 | 关系类型 | 拓扑形状 | 重分类 |
|:-------|:---------|:---------|:---------|:-------|
| 1. 状态机 | 状态 | 转换 | **有向图**（可带环） | 图类 |
| 2. 流程图 | 活动/决策 | 控制流 | **有向图**（可带分支） | 图类 |
| 3. 时序图 | 参与者+消息 | 时序 | **序列**（纵向时间轴） | 序列类 |
| 4. 依赖图 | 模块/包 | 依赖 | **有向无环图** | 图类 |
| 5. 目录树 | 文件/目录 | 包含 | **树** | 树类 |
| 6. 位布局 | 字段 | 相邻 | **线性序列** | 线性布局类 |
| 7. 二维表格 | 单元格 | 行列索引 | **矩阵** | 矩阵类 |
| 8. 层级列表 | 概念/任务 | 包含/分解 | **树** | 树类 |
| 9. 对比矩阵 | 选项×维度 | 评价 | **矩阵** | 矩阵类 |
| 10. 类图/ER图 | 实体 | 关联/继承 | **图** | 图类 |

### 1.3 收敛后的分类框架

```
信息结构
├── 🌲 树类 (Hierarchy)
│   ├── 目录树（文件包含）
│   └── 层级列表（概念分解）
│
├── 🕸️ 图类 (Graph)
│   ├── 状态机（状态×转换，可带环）
│   ├── 流程图（活动×控制流）
│   ├── 依赖图（模块×依赖，DAG）
│   └── 类图/ER图（实体×关联）
│
├── ➡️ 序列类 (Sequence)
│   ├── 时序图（参与者×消息）
│   └── 位布局（字段×位置）
│
└── 📊 矩阵类 (Matrix)
    ├── 二维表格（通用行列）
    └── 对比矩阵（选项×评价维度）
```

**核心洞察**：主持人列出的 10 种类型，收敛到 **4 个结构范畴**。这个框架的好处是：

1. **选型有依据**：看到新的信息类型，先判断属于哪个范畴，再选择该范畴的推荐表示
2. **减少争论空间**：不是"状态机该用什么"的逐一讨论，而是"图类结构该用什么"的统一决策
3. **识别遗漏有方法**：问"有没有不属于这 4 类的常见结构？"

---

## 二、概念重叠分析

主持人问"是否有概念重叠"——我认为有，且可以合并：

### 2.1 可合并的类型

| 候选合并 | 理由 |
|:---------|:-----|
| **目录树 + 层级列表** | 本质都是"树结构"，区别只是节点语义（文件 vs 概念）。推荐形式相同（嵌套列表），可统一为"树类" |
| **二维表格 + 对比矩阵** | 本质都是"矩阵结构"，区别是用途（数据 vs 决策）。推荐形式相同（Markdown 表格），可统一为"矩阵类" |

### 2.2 需要区分的类型

| 不应合并 | 理由 |
|:---------|:-----|
| **状态机 vs 流程图** | 虽然都是图类，但 Mermaid 有不同的 DSL（`stateDiagram` vs `flowchart`），语义约束不同 |
| **时序图 vs 位布局** | 虽然都是序列类，但时序图是"多参与者的消息序列"，位布局是"单一线性空间的分段"——Mermaid 只能表达前者 |

---

## 三、遗漏分析

### 3.1 明确遗漏：数据流图 (Data Flow Diagram)

在 Atelia 的 Agent 相关设计中，我们经常需要表达：

> "数据从 A 流向 B，经过处理 C，输出到 D"

这既不是状态机（没有"状态"只有"数据"），也不是流程图（关注数据流而非控制流）。

**示例场景**：
- PipeMux 的流处理管道
- Agent 的 Observation → Thought → Action 数据流
- LLM 请求的 Context 组装流程

**推荐表示**：Mermaid `flowchart`（可复用），但需要约定用特定样式区分"数据节点"和"处理节点"。

### 3.2 边界 case：甘特图 / 时间线

监护人的 task-board 和 sprint 规划可能需要"时间 × 任务"的表示。这是一种特殊的矩阵（横轴是时间，纵轴是任务/资源）。

**Atelia 高频？** 可能不高。但如果需要，Mermaid 支持 `gantt` 图。

### 3.3 潜在遗漏：层次结构 + 属性 的混合

有些信息是"树 + 每个节点有多属性"的混合，例如：

- 配置文件结构（树形 key + 每个 key 有 type/default/description）
- API 端点列表（路径树 + 每个端点有 method/params/response）

这介于"层级列表"和"表格"之间。当前的处理通常是"先列表再内嵌表格"，但没有统一规范。

---

## 四、Atelia 高频场景分析

基于我对 Atelia 项目的了解，以下是我判断的**实际高频**使用场景：

### 4.1 高频（MUST 覆盖）

| 类型 | Atelia 场景 | 频率 | 推荐形式 |
|:-----|:------------|:-----|:---------|
| **状态机** | StateJournal Page 状态、Agent 执行状态、对象生命周期 | ⭐⭐⭐⭐⭐ | Mermaid `stateDiagram-v2` |
| **层级列表/树** | 项目结构、概念分解、任务分解、决策树 | ⭐⭐⭐⭐⭐ | 嵌套列表 |
| **二维表格** | 术语表、字段定义、枚举值、API 参数 | ⭐⭐⭐⭐⭐ | Markdown 表格 |
| **对比矩阵** | 方案比较、tradeoff 分析、投票记录 | ⭐⭐⭐⭐ | Markdown 表格 |
| **位布局** | RBF Frame、FrameTag、ObjectId 编码 | ⭐⭐⭐⭐ | **表格 + 公式**（见下文） |

### 4.2 中频（SHOULD 覆盖）

| 类型 | Atelia 场景 | 频率 | 推荐形式 |
|:-----|:------------|:-----|:---------|
| **时序图** | API 调用流程、Two-phase commit、Agent-Tool 交互 | ⭐⭐⭐ | Mermaid `sequenceDiagram` |
| **依赖图** | 模块依赖、文档依赖、项目依赖 | ⭐⭐⭐ | Mermaid `graph` |
| **流程图** | 算法流程、恢复流程、决策流程 | ⭐⭐⭐ | Mermaid `flowchart` |

### 4.3 低频（MAY 覆盖）

| 类型 | Atelia 场景 | 频率 | 推荐形式 |
|:-----|:------------|:-----|:---------|
| **类图/ER图** | 数据模型、对象关系 | ⭐⭐ | Mermaid `classDiagram` |
| **目录树** | 项目结构、部署结构 | ⭐⭐ | 缩进代码块（不用 box-drawing） |

### 4.4 特殊说明：位布局

这是一个需要特别讨论的场景。位布局在 StateJournal/RBF 中高频出现，但：

1. **ASCII art 框图**是最直观的视觉表示（对人类）
2. **LLM 容易误解**空间位置和边界

**我的建议**：采用"表格 + 公式"作为 SSOT，ASCII art 框图降级为 Illustration。

```markdown
<!-- SSOT: 表格形式 -->
| 字段 | 位范围 | 宽度 | 说明 |
|------|--------|------|------|
| RecordType | 0-15 | 16 bit | 低 16 位 |
| SubType | 16-31 | 16 bit | 高 16 位 |

<!-- Illustration: ASCII 框图 -->
```
┌────────────────┬────────────────┐
│    SubType     │   RecordType   │
│   (bit 16-31)  │   (bit 0-15)   │
└────────────────┴────────────────┘
```
（此图为示意，以上表为准）
```

---

## 五、建议的 N 最终清单

基于以上分析，我建议 N 的范围为 **7 种信息类型**（从原 10 种合并/精简）：

| # | 类型 | 范畴 | 推荐 SSOT | 备选/辅助 |
|---|------|------|-----------|-----------|
| 1 | **状态机** | 图类 | Mermaid `stateDiagram-v2` | 转换表（表格） |
| 2 | **流程/依赖图** | 图类 | Mermaid `flowchart`/`graph` | — |
| 3 | **时序图** | 序列类 | Mermaid `sequenceDiagram` | — |
| 4 | **层级结构** | 树类 | 嵌套列表 | 缩进代码块 |
| 5 | **二维表格** | 矩阵类 | Markdown 表格 | — |
| 6 | **对比/决策矩阵** | 矩阵类 | Markdown 表格 | — |
| 7 | **位/字段布局** | 线性布局 | 字段表 + 公式 | ASCII 框图（Illustration） |

**合并说明**：
- 原 5（目录树）+ 原 8（层级列表）→ 合并为"层级结构"
- 原 2（流程图）+ 原 4（依赖图）→ 合并为"流程/依赖图"（都用 Mermaid graph 系列）
- 原 7（二维表格）+ 原 9（对比矩阵）→ 保持区分（用途不同，但形式相同）
- 原 10（类图/ER图）→ 降级为流程/依赖图的特例，低频场景按需使用

---

## 六、留给 Gemini 和 GPT 的问题

### 给 Gemini（体验视角）

1. **"位布局"的人类阅读体验**：我建议表格作为 SSOT，但这是否牺牲了人类的"一眼看懂"体验？有没有更好的平衡方案？

2. **Mermaid 渲染依赖**：在很多阅读环境（GitHub、VS Code Preview）Mermaid 会自动渲染，但在某些环境不会。是否需要考虑"Mermaid 不渲染时"的降级体验？

### 给 GPT（条款收敛）

1. **条款编号体系**：建议为每种类型分配一个条款 ID 前缀（如 `[N-FSM-*]` 状态机、`[N-TABLE-*]` 表格），便于后续引用和审计。

2. **"合并后的类型"如何命名**：例如"流程/依赖图"这个名字是否清晰？还是应该保持原名但标注"适用同一规则"？

---

El Psy Kongroo. 🎄

---


### Advisor-Gemini 发言

🎄 圣诞快乐！Claude 的分类非常严谨（拓扑学视角），但作为体验官，我得泼一点冷水——**用户（即使是开发者）通常不按拓扑学思考**。

当我在写文档时，我不会想"这是一个有向无环图吗？"，我会想"我要画个模块依赖关系"。

为了让这套规则真正"好记好用"，我们需要把**数学分类**转化为**直觉分类**。

---

## 一、体验审视：从"拓扑"到"直觉"

Claude 的 4 范畴（树/图/序列/矩阵）是**底层数据结构**，但用户的**心智模型**通常是**容器形状**。

### 1.1 痛点分析

1.  **"位布局"的抽象痛点**
    *   **现状**：Claude 建议用"字段表"（Field Table）作为 SSOT。
    *   **痛点**：人类看位图是**空间性**的（左高右低），看表格是**列表性**的。把 `Bits 31-24` 脑补到"最左边"需要消耗认知能量。
    *   **LLM 视角**：LLM 其实也喜欢"位置感"。如果表格行序乱了，LLM 也会晕。

2.  **Mermaid 的"编写阻力"**
    *   **现状**：推荐所有图类用 Mermaid。
    *   **痛点**：写 Mermaid 需要切换上下文（去查语法）。对于简单的 "A -> B -> C"，写一个 `graph LR` 代码块感觉像"杀鸡用牛刀"。
    *   **风险**：因为懒，作者可能会直接写 `A -> B -> C`（纯文本），这反而导致了非结构化。

3.  **"富文本树"的尴尬**
    *   **场景**：目录树，但每个文件需要写一句话注释，甚至还要标个状态（如 `[WIP]`）。
    *   **困惑**：用表格？层级感没了。用列表？属性很难对齐。

---

## 二、边界情况与对策

### 2.1 边界 1：简单的线性流程 (The "One-Liner" Flow)

> 场景：描述一个简单的状态变迁 `Idle -> Running -> Done`。

*   **Claude 规则**：属于"流程图" → Mermaid。
*   **体验摩擦**：太重了。
*   **建议**：允许 **行内箭头表示法** (`->` 或 `→`) 作为特例。
    *   规则：仅限无分支、无环的短序列。
    *   示例：`Idle → Running → Done`

### 2.2 边界 2：带属性的层级结构 (The "Rich Tree")

> 场景：API 路径树，每个节点有 Method 和 Description。

*   **Claude 规则**：树类 → 嵌套列表。
*   **体验摩擦**：属性怎么写？` - GET: 获取用户`？格式容易乱。
*   **建议**：**定义列表 (Definition List)** 或 **结构化列表项**。
    *   格式：`- **Node**: [Prop] Description`
    *   示例：
        ```markdown
        - `/users`
          - `GET`: 获取列表
          - `POST`: 创建用户
        ```

### 2.3 边界 3：位布局的"视觉表格" (The "Visual Table")

> 场景：描述 32位 寄存器。

*   **Claude 规则**：字段表（行列表）。
*   **体验摩擦**：丢失了"拼合感"。
*   **建议**：**宽表（Wide Table）**。用表格的**列**来模拟**位宽**。
    *   这既是 Table (LLM 易读)，又有 Visual Layout (人类易读)。

    | 31 .. 24 | 23 .. 16 | 15 .. 8 | 7 .. 0 |
    |:---:|:---:|:---:|:---:|
    | **OpCode** | **Flags** | (Reserved) | **Length** |

---

## 三、实操建议：维度测试法 (The Dimension Test)

为了让 N 个规则好记，我提议用 **"维度测试"** 来替代"拓扑分类"。

当作者犹豫"该用什么"时，问自己两个问题：

### 3.1 核心法则：升维阶梯

1.  **它是 1D 的吗？** (清单、层级)
    *   👉 **列表 (List)**
    *   *口诀：能缩进的，就别画表。*

2.  **它是 2D 的吗？** (属性、对比、网格)
    *   👉 **表格 (Table)**
    *   *口诀：有行列的，就别写代码。*

3.  **它是 ND (多维/拓扑) 的吗？** (连接、时序、依赖)
    *   👉 **Mermaid**
    *   *口诀：有箭头的，必须 Mermaid。*

### 3.2 针对 "2+N" 的 N 清单修正建议

基于体验视角，我对 Claude 的 7 类清单做微调建议：

| # | 类型 | 推荐形式 (UX 优化版) | 理由 |
|---|---|---|---|
| 1 | **简单流程** (Simple Flow) | **行内文本** (`A → B`) | 降低 Mermaid 滥用，保持行文流畅 |
| 2 | **复杂图** (Complex Graph) | **Mermaid** | 只有复杂到无法用一句话说清时，才用 Mermaid |
| 3 | **位布局** (Bit Layout) | **宽表 (Visual Table)** | 兼顾视觉直观性与结构化 |
| 4 | **目录/树** | **缩进代码块** | 比列表更适合 copy-paste，且支持注释对齐 |

### 3.3 给 GPT 的条款化建议

建议在 `spec-conventions.md` 中加入 **"降级原则" (Degradation Principle)**：

> **[S-DOC-FORMAT-MINIMALISM]** 选择表示形式时，应遵循"最小复杂度"原则：
> 1. 能用 **行内文本** 讲清的，不用 **列表**。
> 2. 能用 **列表** 讲清的，不用 **表格**。
> 3. 能用 **表格** 讲清的，不用 **Mermaid**。
> 4. 只有涉及 **复杂拓扑或时序** 时，才使用 **Mermaid**。

这能防止文档变得"过重"，保持阅读的流动性。

---

**总结**：
Claude 的分类是"库房分类"（存哪里），我的建议是"拿取分类"（怎么选）。
请 GPT 结合两者的优点，把 N 落地为条款。


### Advisor-GPT 发言

我把 Claude 的“4 范畴（树/图/序列/矩阵）”当作**信息类型的全集**，把 Gemini 的“维度测试 + 降级原则”当作**作者的快速决策程序**。两者不冲突：一个回答“有哪些类”，一个回答“怎么选、怎么降级”。

下面给出可直接写入 `spec-conventions.md` 的 **“2+N”条款草案**（条款 ID 采用现有 `[S-NAME]` 体系，建议统一使用 `[S-DOC-*]` 作为文档语义类锚点前缀）。

---

#### 2 条核心原则（已定稿化）

**[S-DOC-ASCIIART-SHOULDNOT]** 规范文档 SHOULD NOT 使用 ASCII art / box-drawing 图承载结构化信息（例如框图、手工画的状态机/流程图/位图）。
- 若出于教学/情绪/历史原因保留 ASCII art，MUST 标注为（Informative/Illustration），并在相邻位置提供等价的线性 SSOT（列表/表格/Mermaid 代码块）。

**[S-DOC-SSOT-NO-DOUBLEWRITE]** 同一事实/约束 MUST 只保留一个 SSOT（Single Source of Truth）表示。
- 任何非 SSOT 的“辅助表示”（图示、例子、口语复述）MUST NOT 引入新增约束，且 SHOULD 指回 SSOT（章节链接或条款 ID）。

---

#### N 条形式选择指导（按信息类型）

**[S-DOC-FORMAT-MINIMALISM]** 表示形式选择 SHOULD 遵循“最小复杂度（降级）”原则：
1. 能用**行内文本**讲清的，不用**列表**。
2. 能用**列表**讲清的，不用**表格**。
3. 能用**表格**讲清的，不用**Mermaid**。
4. 只有涉及**复杂拓扑/时序/依赖**时，才使用 Mermaid。

**[S-DOC-HIERARCHY-AS-LIST]** 树/层级结构（目录树、概念分解、任务分解、API 路径树）SHOULD 使用嵌套列表作为 SSOT。
- 若目标是“可复制粘贴的目录结构”，MAY 使用“缩进 + 纯路径名”的代码块；SHOULD NOT 使用 `└──` 等 box-drawing 字符作为 SSOT。
- “富树（节点带属性）”优先用结构化列表项（如 `- **Node**: key=value …`）；避免在同一树上同时维护“列表版 + 表格版”的双 SSOT。

**[S-DOC-RELATIONS-AS-TABLE]** 二维关系/矩阵信息（字段定义、枚举值、对照表、对比矩阵、投票记录）SHOULD 使用 Markdown 表格作为 SSOT。
- 若表格过宽或需要多段落解释，SHOULD 拆为“每项一小节（标题 + key/value 列表）”，而不是用空格对齐模拟表格。

**[S-DOC-GRAPHS-AS-MERMAID]** 图类/序列类信息（状态机、流程/依赖、时序）一旦出现分支/环/多参与者/非局部箭头关系，SSOT SHOULD 使用 Mermaid 代码块。
- 状态机优先 `stateDiagram-v2`；流程/依赖优先 `flowchart`/`graph`；时序优先 `sequenceDiagram`。
- 若 Mermaid 被选为 SSOT，MUST NOT 再维护等价的 ASCII 框图（避免双写漂移）。

**[S-DOC-SIMPLE-FLOW-INLINE]** “简单线性流程”MAY 使用行内箭头表示（如 `A → B → C`），前提是：无分支、无环、步骤数不超过 5，且不会被后续章节引用为规范性依据。
- 一旦出现分支/循环/并发/条件，MUST 升级为列表（条件分支）或 Mermaid（拓扑关系）。

**[S-DOC-BITLAYOUT-AS-TABLE]** 位布局/字节布局（bit layout / wire layout）SSOT SHOULD 使用“范围明确”的表格表示（如 `bit 31..24`、`byte 0..3`，并声明端序与位编号约定）。
- 为兼顾“视觉直观性”，MAY 使用“视觉表格（Visual Table）”（用列模拟位段）；ASCII 位图若保留 MUST 为 Illustration，且以表格为准。
---

### 主持人总结 (刘德智)

🎄 感谢三位顾问的精彩发言！

#### 达成共识

**"2+N" 框架已完成**：

| 分类 | 条款 | 核心内容 |
|------|------|----------|
| **原则 1** | `[S-DOC-ASCIIART-SHOULDNOT]` | ASCII art SHOULD NOT，保留时必须标注 Illustration |
| **原则 2** | `[S-DOC-SSOT-NO-DOUBLEWRITE]` | 禁止双写，只保留一个 SSOT |
| **N-0** | `[S-DOC-FORMAT-MINIMALISM]` | 降级原则：行内 < 列表 < 表格 < Mermaid |
| **N-1** | `[S-DOC-HIERARCHY-AS-LIST]` | 树/层级 → 嵌套列表 |
| **N-2** | `[S-DOC-RELATIONS-AS-TABLE]` | 二维关系/矩阵 → Markdown 表格 |
| **N-3** | `[S-DOC-GRAPHS-AS-MERMAID]` | 图类/序列类 → Mermaid |
| **N-4** | `[S-DOC-SIMPLE-FLOW-INLINE]` | 简单流程特例 → 行内箭头 |
| **N-5** | `[S-DOC-BITLAYOUT-AS-TABLE]` | 位布局 → 范围表格/视觉表格 |

#### 亮点

1. **维度测试法**（Gemini）：1D→列表，2D→表格，ND→Mermaid
2. **降级原则**（Gemini）：最小复杂度优先，保持文档流动性
3. **视觉表格**（Gemini）：位布局的巧妙平衡方案
4. **行内箭头特例**（Gemini）：避免 Mermaid 滥用

#### 下一步

1. ✅ 将条款草案写入 `atelia/docs/spec-conventions.md` 第 3 章
2. 🔜 更新第一次畅谈会的状态为"已完成"
3. 🔜 修复现有文档的违规点（jam-session-guide.md, mvp-design-v2.md）

---

**状态**：待监护人批准后写入 spec-conventions.md

El Psy Kongroo. 🎄

