# 畅谈会：DocGraph 实现规划

> **日期**：2026-01-01
> **标签**：#design #planning
> **主持人**：刘德智 (Team Leader)
> **参与者**：Seeker, Curator, Craftsman, Implementer, QA
> **状态**：待开始

---

## 背景与前期进展

### 前期畅谈会成果

基于 [2025-12-30-docgraph-design-review.md](./2025-12-30-docgraph-design-review.md) 和 [2025-12-31-docgraph-rulelayer-design.md](./2025-12-31-docgraph-rulelayer-design.md) 的讨论，我们已经完成了以下重要工作：

#### ✅ 已完成的规范设计工作

1. **Rule-Layer 规范文档 (spec.md) 创建完成**
   - 位置：`/repos/focus/atelia/docs/DocGraph/spec.md`（412行完整规范）
   - 覆盖度：92%（基于 ore.md §3 要求）
   - 一致性：95%（与 api.md、wish-system-rules.md）

2. **Shape-Layer API 文档 (api.md) 优化完成**
   - MVP 状态标记已添加（✅ Enabled, ⚠️ Report-Only, 🚧 Narrowed）
   - 交叉引用完整（指向 spec.md 具体条款）
   - 情感调性优化（导航式设计）

3. **核心问题解决**
   - **P0-A：门禁声明缺失** → ✅ 通过 spec.md §0 + §1 + api.md MVP标记解决
   - **P0-B：错误处理 SSOT 缺失** → ✅ 通过 spec.md §4 完整解决
   - **UX/DX 优化需求** → ✅ 通过 Curator 评估和 api.md 标记添加解决

#### 📊 质量评估结果

| 文档 | 状态 | 评分 | 说明 |
|:-----|:-----|:-----|:-----|
| **spec.md** | ✅ 生产就绪 | 4.4/5 | 完整的 Rule-Layer 规范 |
| **api.md** | ✅ 优化完成 | 4.2/5 | MVP 状态标记已添加 |
| **ore.md** | ⚠️ 参考材料 | - | 设计原矿，部分内容已迁移 |

#### 🎯 当前状态

我们已经完成了 **Why-Layer → Shape-Layer → Rule-Layer** 三个层级的设计工作，现在准备进入 **Plan-Layer → Craft-Layer** 的实现阶段。

---

## 已知后续任务清单（信息性参考）

> **说明**：以下任务是整个 MVP 开发周期的已知任务，本次畅谈会**不要求**讨论所有任务，而是聚焦于即将开始的第一个实现任务。

### 1. 规范完善任务（P0/P1 优先级）

| 任务 | 优先级 | 负责人 | 状态 | 备注 |
|:-----|:-------|:-------|:-----|:-----|
| **P0-1**：补充链接提取规则细节 | P0 | Seeker | 🔄 待完成 | spec.md §3.1 需要补充边定义 |
| **P1-1**：错误码表格增加修复速查列 | P1 | Curator | ⏳ 待安排 | UX/DX 优化 |
| **P1-2**：执行摘要增加流程示意图 | P1 | Curator | ⏳ 待安排 | UX/DX 优化 |

### 2. 实现阶段任务（Plan-Layer → Craft-Layer）

| 任务 | 层级 | 负责人 | 状态 | 备注 |
|:-----|:-----|:-------|:-----|:-----|
| **PL-1**：创建测试向量（Test Vectors） | Plan-Layer | Craftsman+QA | ⏳ 待开始 | 基于 spec.md 条款 |
| **PL-2**：设计实现架构 | Plan-Layer | Implementer | ⏳ 待开始 | 项目结构、依赖关系 |
| **PL-3**：制定里程碑计划 | Plan-Layer | 主持人 | ⏳ 待开始 | MVP 发布路线图 |
| **CL-1**：实现 Registry 扫描 | Craft-Layer | Implementer | ⏳ 待开始 | spec.md §2.1 |
| **CL-2**：实现 frontmatter 解析 | Craft-Layer | Implementer | ⏳ 待开始 | spec.md §2.2 |
| **CL-3**：实现层级进度表格解析 | Craft-Layer | Implementer | ⏳ 待开始 | spec.md §2.2 |
| **CL-4**：实现索引表格生成 | Craft-Layer | Implementer | ⏳ 待开始 | spec.md §3.3 |
| **CL-5**：实现错误处理系统 | Craft-Layer | Implementer | ⏳ 待开始 | spec.md §4 |
| **CL-6**：实现 CLI 接口 | Craft-Layer | Implementer | ⏳ 待开始 | api.md §4 |

### 3. 测试与验证任务

| 任务 | 负责人 | 状态 | 备注 |
|:-----|:-------|:-----|:-----|
| **TV-1**：创建单元测试套件 | QA | ⏳ 待开始 | 基于测试向量 |
| **TV-2**：创建集成测试 | QA | ⏳ 待开始 | 端到端流程 |
| **TV-3**：创建 golden output 测试 | QA | ⏳ 待开始 | 确保输出确定性 |

### 4. 文档与 DX 任务

| 任务 | 负责人 | 状态 | 备注 |
|:-----|:-------|:-----|:-----|
| **DX-1**：创建场景卡片索引 | Curator | ⏳ 待安排 | 快速查找表 |
| **DX-2**：补充 CLI 输出示例 | Curator | ⏳ 待安排 | 人类可读格式 |
| **DX-3**：创建开发者指南 | DocOps | ⏳ 待安排 | 入门教程 |

---

## 本次畅谈会焦点：Plan-Layer 实现规划

> **核心目标**：规划从 Rule-Layer 规范到 Craft-Layer 实现的具体路径，聚焦于**第一个实现任务**。

### 议题 1：测试向量创建（基于 spec.md 条款）

**核心问题**：如何基于 spec.md 的 20 条规范性条款创建可执行的测试向量？

**讨论要点**：
1. **测试向量格式设计**：如何结构化测试用例，使其可映射到 spec.md 条款？
2. **测试数据来源**：使用现有 wishes 目录作为测试数据，还是创建专用测试数据？
3. **验证方法**：如何验证实现符合 spec.md 条款？
4. **测试优先级**：哪些条款需要优先测试（P0 错误处理 vs P1 边界条件）？

**参考材料**：
- spec.md 附录 A：条款索引（20 条 F/A/S/R 条款）
- ore.md §7：测试向量示例
- wish-system-rules.md：上位规则测试需求

### 议题 2：实现架构设计

**核心问题**：如何设计项目结构，使其符合 spec.md 的约束并便于测试？

**讨论要点**：
1. **项目结构**：独立项目 vs atelia 子模块？目录组织？
2. **依赖关系**：Markdig、YamlDotNet、System.IO.Abstractions 的使用方式？
3. **接口实现策略**：如何实现 api.md 的 5 个核心接口，同时满足 spec.md 的 MVP 约束？
4. **错误处理架构**：如何实现 spec.md §4 的错误处理 SSOT？

**参考材料**：
- api.md §3：5 个核心接口定义
- spec.md §2-§5：处理规则约束
- ore.md §5.1：项目结构候选方案

### 议题 3：第一个实现任务选择

**核心问题**：应该从哪个任务开始实现？选择标准是什么？

**候选任务**：
1. **Registry 扫描**（spec.md §2.1）：相对简单，建立基础框架
2. **frontmatter 解析**（spec.md §2.2）：核心功能，依赖较少
3. **错误处理基础**（spec.md §4）：建立错误模型，便于后续调试

**选择标准**：
- **风险可控**：技术复杂度适中，失败风险低
- **价值明显**：能快速验证规范可行性
- **依赖清晰**：依赖关系简单，便于独立测试
- **学习价值**：能为后续任务建立模式

---

## 设计原则

### 1. 规范驱动开发原则
- **实现必须可追溯**：每行代码都应能映射到 spec.md 的具体条款
- **测试先行**：基于 spec.md 条款创建测试向量，再开始实现
- **变更同步**：实现过程中发现规范遗漏，同步更新 spec.md

### 2. 渐进复杂度原则
- **简单开始**：从最简单的核心路径开始实现
- **迭代扩展**：逐步添加边界条件和复杂场景
- **持续验证**：每个迭代都验证与 spec.md 的一致性

### 3. 可测试性原则
- **条款可测试**：每个 spec.md 条款都应有对应的测试用例
- **输出可验证**：生成物（index.md、错误报告）必须可自动化验证
- **行为可复现**：相同输入必须产生相同输出（幂等性）

### 4. 文档即代码原则
- **规范即契约**：spec.md 是实现的唯一权威来源
- **测试即文档**：测试向量展示规范的具体应用
- **代码即证明**：实现代码证明规范的可行性

---

## 预期产出

### 主要产出
1. **测试向量初稿**：基于 spec.md 条款的可执行测试用例
2. **实现架构设计**：项目结构、依赖关系、接口实现策略
3. **第一个任务计划**：明确的任务定义、验收标准、时间估算

### 次要产出
4. **里程碑草案**：MVP 实现的阶段划分和时间预估
5. **风险识别清单**：实现过程中可能遇到的技术风险
6. **依赖关系图**：任务之间的依赖关系和顺序约束

---

## 成功标准

### 主要成功标准
1. ✅ 测试向量覆盖 spec.md 的核心条款（≥80%）
2. ✅ 实现架构得到团队共识
3. ✅ 第一个实现任务明确且可执行

### 次要成功标准
4. ✅ 里程碑计划草案完成
5. ✅ 风险识别清单建立
6. ✅ 团队对实现路径达成共识

---

## 参考资料

### 必读材料
1. [spec.md](../../../atelia/docs/DocGraph/spec.md) - Rule-Layer 规范（实现依据）
2. [api.md](../../../atelia/docs/DocGraph/api.md) - Shape-Layer API（接口定义）
3. [ore.md](../../../atelia/docs/DocGraph/ore.md) §7 - 测试向量示例

### 可选材料
4. [wish-system-rules.md](../../../wishes/specs/wish-system-rules.md) - 上位规则
5. [2025-12-31-docgraph-rulelayer-design.md](./2025-12-31-docgraph-rulelayer-design.md) - 前期讨论记录

---

## 开场引导

大家好！欢迎参加 DocGraph 实现规划畅谈会。

经过前两天的深入讨论，我们已经完成了规范设计阶段的工作：
- ✅ **Why-Layer**：明确了 DocGraph 的核心价值（提取信息并汇总成表格）
- ✅ **Shape-Layer**：定义了 API 外观和接口能力（api.md）
- ✅ **Rule-Layer**：创建了完整的实施约束规范（spec.md）

现在，我们站在 **Plan-Layer** 的起点，准备规划如何将规范转化为可工作的代码（Craft-Layer）。

今天的目标是：**规划从规范到实现的具体路径，并确定第一个实现任务**。

让我们从**议题 1：测试向量创建**开始。首先邀请 **Craftsman** 和 **QA** 从规范审计和测试验证角度，提出测试向量的设计建议。

---

### 主持人开场 (刘德智)
大家好！欢迎来到 DocGraph 实现规划畅谈会。

让我简要回顾一下我们的进展：经过前两天的努力，我们已经拥有了完整的 Rule-Layer 规范（spec.md），覆盖了 92% 的 ore.md 要求，与 api.md 的一致性达到 95%。spec.md 包含了 20 条具体的 F/A/S/R 条款，为实现提供了清晰的约束。

现在，我们需要回答三个关键问题：
1. **如何测试**：如何基于 spec.md 条款创建可执行的测试向量？
2. **如何构建**：如何设计项目结构来实现这些规范？
3. **从何开始**：应该选择哪个任务作为第一个实现？

让我们从**议题 1**开始：测试向量创建。这是规范驱动开发的关键——如果我们不能测试规范，就无法验证实现是否正确。

首先邀请 **Craftsman** 从规范审计角度，提出测试向量的设计原则和格式建议。