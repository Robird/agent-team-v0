# 畅谈会：DocGraph v0.1 简化版MVP设计

> **日期**：2026-01-01
> **标签**：#design #planning
> **主持人**：刘德智 (Team Leader)
> **参与者**：Seeker, Curator, Craftsman
> **状态**：待开始
> **版本上下文**：v0.1 简化版MVP设计

---

## 背景与决策上下文

### 版本战略调整
基于2025-12-31的讨论，我们决定对DocGraph进行**MVP范围缩减**，采用更平滑的阶段分工：

#### 1. 版本目录化策略
```
atelia/docs/DocGraph/
├── v0.1/          # 简化版MVP（当前焦点）
├── future/        # 完整愿景（远期参考）
└── README.md      # 版本导航
```

#### 2. 核心决策：技术简化换取快速交付
- **从**：完整的文档关系分析工具（Markdown解析+链接分析）
- **到**：文档元信息聚合器（仅frontmatter解析）
- **价值**：分散撰写，自动汇总鸟瞰

#### 3. 已完成的基础工作
- ✅ 版本目录结构已创建
- ✅ 现有文档已迁移到future目录
- ✅ v0.1基础框架已建立
- 🔄 scope.md功能边界文档（待我们讨论确定）

### 前期畅谈会成果参考
- [2025-12-30-docgraph-design-review.md](./2025-12-30-docgraph-design-review.md)：问题识别
- [2025-12-31-docgraph-rulelayer-design.md](./2025-12-31-docgraph-rulelayer-design.md)：规范设计
- [2026-01-01-docgraph-implementation-planning.md](./2026-01-01-docgraph-implementation-planning.md)：实现规划

---

## 本次畅谈会焦点：v0.1 功能边界与设计

> **核心目标**：基于版本缩减策略，完成v0.1简化版MVP的设计，确保3-5天可交付可用工具。

### 必读材料
1. **[v0.1/scope.md](../../../atelia/docs/DocGraph/v0.1/scope.md)** - 功能边界文档（核心输入）
   > **说明**：此文档由监护人与主持人讨论确定，定义了v0.1做什么、不做什么。

2. **[future/api.md](../../../atelia/docs/DocGraph/future/api.md)** - 完整API设计（参考）
   > **说明**：仅作为设计参考，v0.1需大幅简化。

3. **[future/spec.md](../../../atelia/docs/DocGraph/future/spec.md)** - 完整规范（参考）
   > **说明**：仅作为设计参考，v0.1需大幅简化。

### 议题 1：v0.1 功能边界确认与细化

**核心问题**：基于scope.md的双阶段模型，我们需要确认和细化哪些具体功能？

**讨论要点**：
1. **第一阶段：文档图构建与验证**
   - frontmatter schema设计（`produce`/`produce_by`字段）
   - Root nodes扫描范围（`wishes/active` 和 `wishes/completed`）
   - `produce`关系闭包构建算法
   - 双向链接验证规则（悬空引用、缺失反向链接）
   - 自动维护规则（缺失frontmatter模板创建）

2. **第二阶段：汇总文档生成（Visitor模式）**
   - 文档图内存模型设计（支持Visitor遍历）
   - Visitor接口设计（`IDocumentGraphVisitor`）
   - 具体Visitor实现：术语表生成器、问题汇总器
   - 输出格式设计：紧凑列表 vs 表格

3. **已知汇总需求**
   - **术语表**：从`defines`字段生成紧凑Markdown列表
     - 格式：文档路径标题 + bullet列表（术语名 + 解释）
     - 目标：形成紧密的术语参考
   - **问题汇总**：从`issues`字段生成分类表格
     - 字段：问题描述、来源、状态、负责人
     - 目标：集中跟踪分散记录的问题

4. **扩展性设计**
   - 如何按需添加新的Visitor
   - frontmatter字段的开放约定
   - 渐进抽象路径（代码 → 模式 → 配置）

**预期产出**：
- 确认的frontmatter schema
- 明确的输入输出约定
- 错误处理策略

### 议题 2：v0.1 API 简化设计

**核心问题**：如何从完整的5接口设计简化为v0.1的最小接口集？

**候选简化方案**：
```csharp
// 方案A：极简单接口
public interface IDocMetaTool
{
    ScanResult Scan(string directory);
    string GenerateTable(ScanResult result);
}

// 方案B：两个核心接口
public interface IFrontmatterParser
{
    DocumentMetadata Parse(string filePath);
}

public interface IMetadataAggregator  
{
    string GenerateSummary(IEnumerable<DocumentMetadata> docs);
}

// 方案C：保持架构但简化实现
// （基于future/api.md但大幅简化每个接口）
```

**讨论要点**：
1. **接口数量**：单接口 vs 多接口
2. **数据模型**：简化的DocumentMetadata结构
3. **扩展性考虑**：为v1.0预留的扩展点
4. **测试友好性**：接口设计便于单元测试

**预期产出**：
- v0.1 api.md草案
- 简化的数据模型定义
- 接口使用示例

### 议题 3：v0.1 实现规范制定

**核心问题**：基于简化的功能边界和API，需要哪些具体的实现约束？

**规范重点**：
1. **frontmatter解析约束**：
   - YAML解析库选择（YamlDotNet）
   - 编码处理（UTF-8假设）
   - 错误恢复策略

2. **文件扫描约束**：
   - 目录遍历规则
   - 文件过滤（仅`.md`文件）
   - 性能考虑（全量扫描）

3. **表格生成约束**：
   - 输出格式稳定性（幂等性）
   - 列排序和格式化
   - 特殊字符处理

4. **错误报告约束**：
   - 错误信息格式
   - 退出码策略
   - 日志输出格式

**预期产出**：
- v0.1 spec.md草案
- 关键约束条款
- 测试要点提示

### 议题 4：v0.1 开发计划制定

**核心问题**：如何规划3-5天的开发工作，确保快速交付？

**任务分解建议**：
1. **Day 1**：核心框架搭建
   - 项目结构创建
   - 基础接口实现
   - 单元测试框架

2. **Day 2**：frontmatter解析实现
   - YAML解析集成
   - 字段提取逻辑
   - 错误处理实现

3. **Day 3**：表格生成实现
   - 表格渲染逻辑
   - 格式美化
   - 集成测试

4. **Day 4**：CLI和优化
   - 命令行接口
   - 性能优化
   - 文档完善

5. **Day 5**：测试和发布
   - 端到端测试
   - 打包发布
   - 使用文档

**预期产出**：
- 详细的任务分解
- 责任分配建议
- 验收标准定义

---

## 设计原则（v0.1特定）

### 1. 简化优先原则
- **功能简化**：只做frontmatter，不做正文分析
- **接口简化**：最小接口集，避免过度设计
- **实现简化**：选择成熟技术栈，避免复杂算法

### 2. 快速交付原则
- **时间盒**：3-5天交付可用工具
- **增量价值**：每个小功能都有独立价值
- **用户反馈**：快速发布，基于反馈迭代

### 3. 质量底线原则
- **正确性**：frontmatter解析必须准确
- **稳定性**：相同输入产生相同输出
- **可测试性**：每个功能都有对应测试

### 4. 演进友好原则
- **扩展点预留**：为v1.0功能预留接口
- **数据兼容**：v0.1输出可为v1.0输入
- **配置演进**：支持未来配置格式扩展

---

## 预期产出

### 主要产出（本次畅谈会必须完成）
1. ✅ **v0.1/scope.md 最终版**：确认的功能边界文档
2. ✅ **v0.1/api.md 草案**：简化版API设计
3. ✅ **v0.1/spec.md 草案**：简化版实现规范
4. ✅ **开发计划**：3-5天详细任务分解

### 次要产出（如有时间）
5. ⏳ **示例文档**：展示frontmatter schema使用
6. ⏳ **测试用例草案**：关键测试场景定义
7. ⏳ **CLI设计草案**：命令行接口设计

---

## 成功标准

### 主要成功标准
1. ✅ 团队对v0.1功能边界达成共识
2. ✅ 产出完整可实施的api.md和spec.md
3. ✅ 制定可行的3-5天开发计划
4. ✅ 明确v0.1与future版本的关系

### 次要成功标准
5. ✅ 识别v0.1的主要技术风险
6. ✅ 确定frontmatter schema标准
7. ✅ 规划v1.0的扩展点

---

## 参考资料

### 核心参考
1. [v0.1/scope.md](../../../atelia/docs/DocGraph/v0.1/scope.md) - **必读**，功能边界定义
2. [future/api.md](../../../atelia/docs/DocGraph/future/api.md) - 完整API设计参考
3. [future/spec.md](../../../atelia/docs/DocGraph/future/spec.md) - 完整规范参考

### 背景参考
4. [2025-12-31讨论记录](../../chat-log/2025-12/31.md) - 版本缩减决策背景
5. [wishes/active/wish-0002-doc-graph-tool.md](../../../wishes/active/wish-0002-doc-graph-tool.md) - 原始需求

### 技术参考
6. [YamlDotNet文档](https://github.com/aaubry/YamlDotNet) - YAML解析库
7. [System.CommandLine文档](https://github.com/dotnet/command-line-api) - CLI框架候选

---

## 开场引导

大家好！欢迎参加DocGraph v0.1简化版MVP设计畅谈会。

经过昨天的深入讨论，我们做出了一个重要的战略决策：**大幅缩减MVP范围，通过技术简化换取快速交付**。

### 决策回顾
1. **版本目录化**：创建v0.1（简化版）和future（完整版）分离
2. **技术简化**：只处理frontmatter，避免Markdown正文解析复杂性  
3. **核心价值**：聚焦"分散撰写，自动汇总鸟瞰"
4. **时间目标**：3-5天交付可用工具

### 今天的目标
基于已经创建的`v0.1/scope.md`功能边界文档，我们需要完成：
1. **确认和细化功能边界**
2. **设计简化版API**
3. **制定实现规范**
4. **规划开发计划**

### 特别提醒
- **参考但不依赖**：future目录中的完整设计仅作参考，v0.1必须大幅简化
- **边界清晰**：严格遵循scope.md的"做什么、不做什么"
- **快速决策**：目标是产出可实施的文档，不是完美设计

让我们从**议题1：v0.1功能边界确认与细化**开始。首先邀请 **Seeker** 从概念架构角度，提出frontmatter schema的设计建议。

---

### 主持人开场 (刘德智)
大家好！欢迎来到DocGraph v0.1简化版MVP设计畅谈会。

让我简要回顾一下我们的战略调整：经过评估，我们决定采用更平滑的阶段分工，创建v0.1简化版聚焦frontmatter解析，快速交付"分散撰写，自动汇总鸟瞰"的核心价值。

现在，我们拥有：
- ✅ 版本目录结构（v0.1 / future）
- ✅ 基础文档框架
- 🔄 scope.md功能边界文档（待我们确认细化）

今天我们需要回答四个关键问题：
1. **边界确认**：v0.1具体做什么、不做什么？
2. **接口设计**：如何简化API到最小可用集？
3. **规范制定**：需要哪些具体实现约束？
4. **计划制定**：如何3-5天交付可用工具？

让我们从**议题1**开始：v0.1功能边界确认与细化。这是所有后续工作的基础——如果边界不清晰，设计和实现都会偏离方向。

首先邀请 **Seeker** 从概念架构角度，基于scope.md的框架，提出frontmatter schema的具体设计建议。