# 外部记忆维护配方 (External Memory Maintenance Recipe)

> AI Team 外部记忆文件的维护方法论。
> 本文件是 Team Leader 维护认知文件系统的 SSOT。
>
> **版本**: 1.0.0
> **创建**: 2025-12-26
> **来源**: status.md 重构实践

---

## 1. 概述

### 1.1 什么是外部记忆

AI Agent 的认知连续性依赖**外部记忆文件**——这些文件是 Agent 的"本体"，而非会话或模型。

> **核心隐喻**：外部记忆是 Agent 的"大脑皮层"，会话是"工作记忆"。
> 
> 工作记忆（上下文窗口）有限且易失，大脑皮层（外部文件）持久且可扩展。

### 1.2 为什么需要维护

外部记忆文件会自然**熵增**：
- 信息堆积但不整理
- 状态过时但不更新
- 细节淹没结构

**不维护的后果**：
- 新会话唤醒效率降低（读取大量过时信息）
- 决策依据不准确（基于过时状态）
- Token 浪费（加载无用内容）

### 1.3 核心原则

| 原则 | 说明 |
|:-----|:-----|
| **[EMM-01] 时效衰减** | 信息详细度 ∝ 1/时间距离（越旧越压缩） |
| **[EMM-02] 链接优于复制** | 详细信息通过链接访问，不在核心文件复制 |
| **[EMM-03] 可覆盖优于追加** | 状态类文件应可覆盖更新，而非无限追加 |
| **[EMM-04] 单一职责** | 每个文件有明确的职责边界 |
| **[EMM-05] 便签闭环** | 维护完成后写便签记录经验 |

---

## 2. 文件类型元模型

### 2.1 六种文件类型

| 类型 | 代表文件 | 隐喻 | 写入模式 | 维护策略 |
|:-----|:---------|:-----|:---------|:---------|
| **Dashboard** | status.md | 仪表盘 | 覆盖 | 定期刷新快照 |
| **Identity** | index.md | 身份证 | 积累+整理 | 定期 Rewrite |
| **TaskQueue** | todo.md, task-board.md | 待办清单 | 增删 | 完成即删除 |
| **Inbox** | inbox.md | 收件箱 | 只追加 | Keeper 整理 |
| **Archive** | meeting/*.md | 档案馆 | 只追加 | 不修改，可索引 |
| **Recipe** | recipe/*.md | 配方书 | 版本演进 | 持续完善 |

### 2.2 各类型详解

#### Dashboard（仪表盘类）

**代表**：`status.md`

**核心问题**：现在在哪里？

**特征**：
- 只反映"当前状态"，不记录历史
- 可以完全覆盖更新
- 应该能在 30 秒内扫完

**维护信号**：
- 最后更新超过 3 天
- 重大里程碑完成后
- 项目状态发生变化

**维护方法**：
1. 收集最新状态数据（可委派 Investigator）
2. 按仪表盘结构重写
3. 旧的详细内容移入归档或删除

**反模式**：
- ❌ 在"最近更新"里堆积多个里程碑
- ❌ 保留已完成的 Sprint 进度
- ❌ 详细的会议产出表格

---

#### Identity（身份认知类）

**代表**：`members/{specialist}/index.md`

**核心问题**：我是谁？我怎么工作？

**特征**：
- 核心身份相对稳定
- 近期洞见不断积累
- 需要定期整理压缩

**维护信号**：
- 洞见章节超过 10 条
- 有重复或冲突的内容
- 结构变得混乱

**维护方法**：
1. 保持核心身份章节稳定
2. 洞见章节定期归档（移入 lessons-learned.md）
3. 过时信息删除，有价值的压缩保留

---

#### TaskQueue（待办事项类）

**代表**：`todo.md`、`task-board.md`

**核心问题**：接下来做什么？

**特征**：
- 完成即删除
- 层次表达目标拆分
- 每个叶子节点应有上下文指针

**维护信号**：
- 存在已完成但未删除的任务
- 任务描述与当前状态不符
- 优先级需要调整

**维护方法**：
1. 删除已完成任务
2. 更新进行中任务的状态
3. 重新评估优先级

---

#### Inbox（便签收集类）

**代表**：`members/{specialist}/inbox.md`

**核心问题**：有什么新想法/经验？

**特征**：
- 只追加，不修改
- 写入门槛极低
- 由 MemoryPalaceKeeper 定期整理

**维护信号**：
- 便签数量超过 10 条
- 存在可归类的便签

**维护方法**：
- **Specialist**：只管写便签
- **MemoryPalaceKeeper**：定期整理归档

---

#### Archive（档案馆类）

**代表**：`meeting/*.md`、`archive/*.md`

**核心问题**：发生过什么？

**特征**：
- 只追加，不修改（历史不可变）
- 可以添加索引和摘要
- 完整保留原始记录

**维护信号**：
- 通常不需要维护
- 可以建立索引便于查找

**维护方法**：
- 不修改原始内容
- 可在独立索引文件中建立引用

---

#### Recipe（配方书类）

**代表**：`recipe/*.md`

**核心问题**：怎么做这件事？

**特征**：
- 版本演进
- 持续完善
- 应用经验反馈

**维护信号**：
- 实践中发现不足
- 有新的最佳实践
- 需要适应新场景

**维护方法**：
1. 记录版本变更
2. 保持向后兼容（或明确 breaking change）
3. 从实践中提炼改进

---

## 3. 维护流程

### 3.1 识别维护需求

**主动检查**（建议每次会话开始）：

```
OnSessionStart:
  1. 读取 status.md → 检查最后更新日期
  2. 读取 inbox.md → 检查便签数量
  3. 读取 todo.md → 检查任务状态
  
  If 任一文件需要维护:
    优先级判断 → 决定是否本次会话处理
```

**被动触发**：
- 重大里程碑完成后
- 监护人明确要求
- 发现信息明显过时

### 3.2 标准维护流程

```
┌─────────────────────────────────────────────────────────┐
│  Phase 1: 诊断 (Diagnose)                               │
│  - 识别文件类型                                          │
│  - 评估过时程度                                          │
│  - 确定维护范围                                          │
└───────────────────────────┬─────────────────────────────┘
                            ▼
┌─────────────────────────────────────────────────────────┐
│  Phase 2: 设计 (Design)                                 │
│  - 可选：咨询 Advisor 设计策略                           │
│  - 确定新结构/内容                                       │
│  - 识别需要收集的数据                                    │
└───────────────────────────┬─────────────────────────────┘
                            ▼
┌─────────────────────────────────────────────────────────┐
│  Phase 3: 收集 (Collect)                                │
│  - 委派 Investigator 收集状态数据                        │
│  - 或自行读取相关文件                                    │
│  - 整理待更新的内容                                      │
└───────────────────────────┬─────────────────────────────┘
                            ▼
┌─────────────────────────────────────────────────────────┐
│  Phase 4: 执行 (Execute)                                │
│  - 按文件类型选择维护方法                                │
│  - Dashboard: 覆盖重写                                   │
│  - Identity: 整理压缩                                    │
│  - TaskQueue: 增删更新                                   │
└───────────────────────────┬─────────────────────────────┘
                            ▼
┌─────────────────────────────────────────────────────────┐
│  Phase 5: 闭环 (Close)                                  │
│  - 写便签记录本次维护经验                                │
│  - 如有方法论洞见，考虑更新 Recipe                        │
└─────────────────────────────────────────────────────────┘
```

### 3.3 委派模式

**何时委派**：
- 需要收集多项目状态 → Investigator
- 需要设计策略 → Advisor-Claude
- 需要验证一致性 → Auditor

**何时自己做**：
- 简单的状态更新
- 删除已完成任务
- 小范围修改

---

## 4. Dashboard 维护详解

> Dashboard（仪表盘）是最常需要维护的类型，本节提供详细指南。

### 4.1 核心设计原则

> **"仪表盘，不是航行日志。"**
>
> 只回答"现在在哪里"，不回答"做过什么"或"要做什么"。

| 原则 | 说明 |
|:-----|:-----|
| **快照原则** | 可完全覆盖更新，而非追加 |
| **30 秒原则** | 应能在 30 秒内扫完核心状态 |
| **链接原则** | 详细信息通过链接访问 |

### 4.2 推荐结构

```markdown
# Project Status Snapshot

## 最近更新 (YYYY-MM-DD)
# ← 只保留最新一条里程碑

## 🎯 当前焦点
# ← 2-3 个当前推进中的工作流

## 📦 项目状态仪表盘
# ← 每个项目 2-4 行状态

## 🧠 团队/技术状态
# ← 相对稳定的结构信息

## 🔗 Key References
# ← 索引链接
```

### 4.3 每个项目的状态格式

```markdown
### ProjectName
| 维度 | 状态 |
|:-----|:-----|
| **Tier** | N — 状态描述 |
| **测试** | XXX passed |
| **入口** | [link](path) |

> 一句话描述
```

### 4.4 维护检查清单

- [ ] 最近更新只保留一条
- [ ] 当前焦点是真正的当前工作
- [ ] 每个项目状态反映最新情况
- [ ] 没有已完成的历史 Sprint 信息
- [ ] 没有详细的会议产出表格
- [ ] 链接都是有效的

---

## 5. 常见问题

### Q1: 多久维护一次？

**Dashboard**：每次重大里程碑后，或超过 3 天未更新
**Identity**：每 1-2 周，或洞见超过 10 条
**TaskQueue**：每次任务完成后
**Inbox**：由 MemoryPalaceKeeper 定期处理

### Q2: 维护 vs 新建？

如果文件已严重过时（>50% 内容需要修改），考虑完全重写而非逐条修改。

### Q3: 如何避免维护负担？

- **即时原则**：完成任务后立即更新相关文件
- **便签缓冲**：不确定的内容先写便签，定期整理
- **委派分担**：利用 SubAgent 收集数据

### Q4: 历史信息如何保留？

- **Archive 类**：原样保留在 meeting/ 或 archive/
- **Dashboard 类**：压缩为里程碑表的一行
- **Identity 类**：移入 lessons-learned.md

---

## 6. 附录

### 附录 A: 文件类型速查表

| 文件 | 类型 | 维护频率 | 维护方法 |
|:-----|:-----|:---------|:---------|
| status.md | Dashboard | 每里程碑 | 覆盖重写 |
| index.md | Identity | 1-2周 | 整理压缩 |
| todo.md | TaskQueue | 每任务 | 增删更新 |
| task-board.md | TaskQueue | 每任务 | 增删更新 |
| inbox.md | Inbox | Keeper处理 | 只追加 |
| meeting/*.md | Archive | 不维护 | 只追加 |
| recipe/*.md | Recipe | 按需 | 版本演进 |

### 附录 B: 原则速查表

| 编号 | 原则 | 内容 |
|:-----|:-----|:-----|
| EMM-01 | 时效衰减 | 信息详细度 ∝ 1/时间距离 |
| EMM-02 | 链接优于复制 | 详细信息通过链接访问 |
| EMM-03 | 可覆盖优于追加 | 状态类文件应可覆盖更新 |
| EMM-04 | 单一职责 | 每个文件有明确职责边界 |
| EMM-05 | 便签闭环 | 维护完成后写便签记录 |

---

## 变更日志

| 版本 | 日期 | 变更 |
|------|------|------|
| 1.0.0 | 2025-12-26 | 初始版本，来自 status.md 重构实践 |
