# 战略-战术双会话协作配方

> **版本**: 0.2  
> **创建**: 2025-12-25  
> **状态**: 实验验证中  
> **本质**: 通过水平切分扩展多会话复合体的总体有效上下文

---

## 1. 概述

战略-战术双会话是一种**分层思考**机制：
- **战略层会话**：保持高层视角，维护状态，决定"下一步做什么"
- **战术层会话**：专注执行，读取任务，产出结果

两个会话通过**固定文件**交换信息，由**调度器**（目前由监护人承担）转发激活信号。

```
┌─────────────────────────────────────────────────────┐
│  战略层会话 (Strategic)                              │
│  - 持有整体计划和进度状态                             │
│  - 决定"下一步做什么"                                │
│  - 汇总执行结果，更新状态                             │
└──────────────────────┬──────────────────────────────┘
                       │ 调度器转发
                       ▼
┌─────────────────────────────────────────────────────┐
│  战术层会话 (Tactical)                               │
│  - 读取任务描述                                      │
│  - 执行具体工作（畅谈会/审计/起草/实施）                │
│  - 输出结果到文件                                    │
└─────────────────────────────────────────────────────┘
```

---

## 2. 交互文件

| 文件 | 方向 | 用途 |
|------|------|------|
| `agent-team/handoffs/current-task.md` | 战略→战术 | 当前任务描述 |
| `agent-team/handoffs/task-result.md` | 战术→战略 | 任务执行结果 |
| `agent-team/handoffs/session-state.md` | 战略层维护 | 会话状态快照 |
| `agent-team/handoffs/session-protocol.md` | 共享 | 交互协议定义 |

---

## 3. 调度器协议

### 3.1 激活信号格式

调度器发送的 User 消息采用固定格式：

```
[来自{层级}会话的消息]

{消息内容}

---
请自主思考和行动。完成后告诉我你想向哪个层级的会话发送什么信息，我将为你转发。
```

### 3.2 汇报信号格式

会话在 Response 末尾采用固定格式请求转发：

```
---
## 📤 请转发至{目标层级}会话

{要转发的消息内容}
```

---

## 4. 战术层视角

> 本节由战术层会话维护

### 4.1 接收任务

当收到调度器转发的激活消息时：
1. 阅读 `current-task.md` 获取任务详情
2. 阅读必要的输入文件
3. 自主决定执行方式（自行完成 or 委派 Specialist）

### 4.2 执行任务

- 聚焦于任务目标，不需要关心全局状态
- 可以调用 `runSubagent` 委派具体工作
- 遇到阻塞时，可以请求调度器协助

### 4.3 汇报结果

1. 将结果写入 `task-result.md`
2. 更新 `current-task.md` 状态为已完成
3. 在 Response 末尾请求转发汇报消息

### 4.4 首次验证记录 (2025-12-25)

| 任务 | 状态 | 观察 |
|------|------|------|
| T-20251225-01 审计 | ✅ | 任务边界清晰，专注执行模式有效 |
| T-20251225-02 起草 | ✅ | 结构化输出高效，无需畅谈会 |

---

## 5. 战略层视角

> 本节由战略层会话维护（2025-12-25 首次编写）

### 5.1 会话启动

当你作为战略层会话被激活时：

1. **阅读本配方**：了解双会话机制
2. **阅读 `session-state.md`**：恢复当前状态和进度
3. **确认今日目标**：检查目标是否仍然有效

### 5.2 维护状态

`session-state.md` 是你的"外部记忆"，需要持续维护：

```markdown
# 会话状态快照

> 最后更新: YYYY-MM-DD HH:MM

## 今日目标
- [ ] 目标 1
- [x] 目标 2 ✅

## 已完成任务
| ID | 标题 | 状态 | 产出 |

## 当前任务
- **ID**: T-YYYYMMDD-NN
- **状态**: 已派发至战术层
- **描述**: ...

## 待决策
（如有需要监护人决策的事项）
```

### 5.3 派发任务

**步骤**：

1. **删除旧任务文件**：`rm current-task.md`
2. **创建新任务文件**：按模板填写 `current-task.md`
3. **更新状态**：在 `session-state.md` 中标记当前任务
4. **请求转发**：在 Response 末尾使用标准格式

**任务文件模板**：

```markdown
# 任务: <简短标题>

## 元信息
- **任务 ID**: T-YYYYMMDD-NN
- **类型**: 审计 | 起草 | 畅谈会 | 实施
- **优先级**: P0 | P1 | P2
- **预计时长**: XX 分钟

## 背景
<为什么需要这个任务>

## 目标
<期望的产出>

## 输入文件
- `path/to/file.md` — 说明

## 约束
- <限制条件>

## 完成标准
- [ ] 标准 1
- [ ] 标准 2
```

### 5.4 汇总结果

当收到战术层汇报时：

1. **读取 `task-result.md`**：了解执行结果和产出
2. **验证完成标准**：确认任务是否真正完成
3. **更新 `session-state.md`**：
   - 将任务移入"已完成"
   - 更新今日进度
4. **决定下一步**：
   - 派发下一个任务？
   - 需要监护人决策？
   - 今日工作结束？

### 5.5 与监护人协作

监护人是调度器，也是资源提供者。可以向监护人请求：

- **决策支持**：当有多个选项需要取舍时
- **会话外资源**：如需要打开新会话、访问外部服务
- **优先级调整**：当发现计划需要变更时

**请求格式**（在 Response 中直接说明）：

```markdown
## 🎯 Request: <请求类型>

<请求内容>
```

### 5.6 首次验证记录 (2025-12-25)

| 操作 | 状态 | 观察 |
|------|------|------|
| 创建任务文件 | ✅ | 删除旧文件再创建，避免编辑冲突 |
| 状态维护 | ✅ | `session-state.md` 作为外部记忆有效 |
| 结果汇总 | ✅ | 能正确读取战术层产出并更新状态 |
| 决策协作 | ✅ | 监护人"兼听则明"建议采纳机制有效 |

### 5.7 关键心智模型

> **你是指挥官，不是士兵。**

- 不要陷入执行细节——那是战术层的工作
- 保持全局视角，关注目标和进度
- 信任战术层的自主决策能力
- 把复杂任务拆分为可独立验收的小任务

> **文件是你的外部记忆。**

- 会话结束后，你的上下文会丢失
- 但 `session-state.md` 会保留
- 下次激活时，从文件恢复状态

---

## 6. 核心价值

### 6.1 上下文扩展

每个会话有自己的上下文窗口：
- 战略层保持高层视角，不被执行细节淹没
- 战术层专注当前任务，不需要了解全局历史
- **总体有效上下文 ≈ 战略层 + 战术层**（水平切分）

### 6.2 认知专注

- 战略层：规划、决策、状态追踪
- 战术层：分析、执行、产出

### 6.3 可追溯性

所有交互通过文件记录，可供回顾和审计。

---

## 7. 演进方向

参见 [layered-multi-session-agent.md](../goals/layered-multi-session-agent.md)

---

## 变更日志

| 版本 | 日期 | 变更 |
|------|------|------|
| 0.2 | 2025-12-25 | 战略层视角完善：会话启动、任务模板、心智模型 |
| 0.1 | 2025-12-25 | 初始版本，基于首次双会话实验 |
