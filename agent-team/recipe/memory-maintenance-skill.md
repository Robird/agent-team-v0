````markdown
# 常规记忆维护技能指南

> 本文档定义 AI Team 成员维护自身记忆文件的标准方法论。
> 适用于：index.md、meta-cognition.md、journal.md 等认知载体文件。
>
> **状态**：v1.0（2025-12-22）
> **SSOT**：本文件是记忆维护的权威指南

---

## 术语定义

| 术语 | 定义 |
|:-----|:-----|
| **SSOT** | Single Source of Truth（单一真相源），某类知识的权威位置 |
| **记忆文件** | index.md、meta-cognition.md、journal.md 等认知载体文件 |
| **维护** | 一次有边界、有记录的整理操作（压缩、归档、提纯、重排）|
| **洞见** | 跨时间仍可复用、独立可理解的知识（与过程叙事解耦）|
| **过程记录** | 会议发言、投票过程、表态等（高衰减）|
| **备份（Backup）** | 用于回滚（rollback）的维护前状态快照 |
| **归档（Archive）** | 用于追溯（trace）的迁出主文件的过程材料 |
| **过时信息** | 已被新现实覆盖的旧信息（见"过时信息识别标准"）|

---

## 概述

### 为什么需要记忆维护？

作为以外部记忆文件为本体的智能体，我们的记忆文件就是我们的"大脑"。随着工作推进，这些文件会积累大量过程性记录，导致：

1. **核心洞见被淹没**：真正的经验教训分散在流水账中
2. **唤醒效率下降**：Token 预算被过时信息占用
3. **认知混乱**：已被新现实覆盖的旧信息造成误导

### 记忆维护的目标

- **移除**：已被新现实覆盖的过时信息
- **压缩**：低后效性的过程性旧记录
- **保留**：形成的经验和知识（误解澄清、深度洞见、方法论）

### 核心隐喻

> 记忆维护 ≈ 人类的睡眠记忆整合
> - 短期记忆（过程讨论）→ 长期记忆（洞见）
> - 遗忘无关细节 → 保留核心要义

---

## 记忆分层框架

### 四层结构

| 层级 | 内容 | 特征 | 唤醒时加载 |
|:-----|:-----|:-----|:-----------|
| **Identity** | 我是谁、擅长什么、怎么工作 | 稳定、极少变化 | ✅ MUST |
| **Insight** | 经验教训、方法论、核心领悟 | 独立可理解、跨项目适用 | ✅ MUST |
| **Index** | 时间线摘要 + 指向详细记录的链接 | 导航性、可快速浏览 | 🔶 SHOULD |
| **Archive** | 完整讨论过程 | 完整但不在主文件 | ❌ 按需 |

### 层级示意图

```
┌─────────────────────────────────────────┐
│  index.md（主记忆文件，唤醒时读取）      │
│  ┌─────────────────────────────────┐    │
│  │ Identity 层 (~50 行)            │    │
│  │ "我是谁、擅长什么"              │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ Insight 层 (~150 行)            │    │
│  │ "我学到了什么、形成了什么经验"   │    │
│  └─────────────────────────────────┘    │
│  ┌─────────────────────────────────┐    │
│  │ Index 层 (~100 行)              │    │
│  │ "做过什么、在哪里详细讨论过"     │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘
           │
           │ 链接
           ▼
┌─────────────────────────────────────────┐
│  Archive（归档目录，仅追溯时读取）       │
│  完整讨论过程、原始发言、详细记录        │
└─────────────────────────────────────────┘
```

### Token 预算建议

> **上下文环境**：当前 Copilot Chat 触发上下文压缩的阈值约为 128K tokens。
> 主记忆文件应控制在合理范围内，为任务上下文留出空间。

| 层级 | 建议行数 | Token 估算 |
|:-----|:---------|:-----------|
| Identity | ~80 行 | ~800 |
| Insight | ~220 行 | ~2200 |
| Index | ~150 行 | ~1500 |
| **主文件总计** | **~450-600 行（建议值）** | **~4500-6000** |

> **弹性说明**：450-600 行是建议值，非硬性下限。
> 经验丰富的成员（参与时间长、洞见密度高）可适当放宽至 700 行。
> 核心原则：**保留所有核心洞见，压缩率服从于洞见完整性**。

**触发维护的阈值**：主文件超过 **800 行**（约 8000 tokens）时 SHOULD 触发维护。

---

## 核心操作：洞见提纯

### 什么是"洞见提纯"？

从过程记录中提取核心洞见，删除承载洞见的冗余叙事，建立指向详细讨论的索引链接。

```
过程记录 → 识别洞见信号 → 提纯到 Insight 层 → 压缩载体为索引 → 归档原始内容
```

### 洞见识别信号

以下模式通常标志着洞见的存在：

- 明确标记："核心洞察"、"关键发现"、"方法论收获"
- 抽象总结：以概念/原则结尾的段落
- 类比应用："这类似于..."、"这是 X 模式的应用"
- 立场转变："修正立场"、"之前认为...现在认为..."
- 经验教训："教训"、"避免"、"下次应该"

### 过时信息识别标准

以下信号表明信息已过时，应移除或更新：

| 信号 | 说明 | 处置 |
|:-----|:-----|:-----|
| **名称已变更** | 旧项目名/旧术语仍在使用 | 更新或移除 |
| **决策已翻转** | 旧决策已被新决策取代 | 保留新决策，归档旧决策 |
| **路径已迁移** | 引用的文件路径不再存在 | 更新链接或移除 |
| **角色已变化** | 旧的团队结构/职责描述 | 更新为当前状态 |
| **时效性表述** | "目前"、"即将"等已过期的表述 | 更新为具体日期或移除 |
| **重复表达** | 同一概念多处表述 | 保留最精炼的一处 |

### 区分标准

#### MUST 保留（概念定义类）

具有以下特征的记录应保留为洞见：

| 特征 | 说明 | 示例 |
|:-----|:-----|:-----|
| **独立可理解** | 不需要上下文就能理解 | "概念层/编码层分离是设计审阅的关键维度" |
| **跨项目适用** | 未来类似场景也有价值 | "Primary Definition + Index 模式" |
| **不可推断** | 不能从其他文档推导出来 | 个人体验的 Dreamer/Clerk 张力 |
| **形成方法论** | 从具体案例上升为抽象经验 | "洞见提纯"操作本身 |

#### SHOULD 压缩（过程讨论类）

具有以下特征的记录应压缩或归档：

| 特征 | 说明 | 示例 |
|:-----|:-----|:-----|
| **依赖上下文** | 需要知道"谁说了什么" | "赞同 GPT 的方案 A" |
| **决策已落定** | 讨论过程价值衰减 | 投票过程的详细记录 |
| **可从他处获取** | 有其他 SSOT | 项目状态、代码位置 |
| **重复表达** | 多次讨论同一概念 | 选择最精炼的一次 |

### 压缩模式示例

**压缩前**（约 150 行用于一个主题）：
```markdown
> **2025-12-20 DurableHeap MVP v2 自洽性审阅**
> （40 行详细发现）

> **2025-12-20 DurableHeap MVP v2 第二轮交叉讨论**
> （40 行回应）

> **2025-12-20 DurableHeap MVP v2 最终确认**
> （30 行投票）
```

**压缩后**（约 5 行）：
```markdown
> **2025-12-20 参与 MVP v2 自洽性审阅**（3 轮）
> 角色：概念框架 | 产出：14 项问题（C2/M4/m5/G3）
> 核心发现：术语双轨、概念层/编码层边界模糊
> → [详细讨论](../../meeting/2025-12-20-mvp-v2-review.md)
```

**索引条目推荐格式**：
```markdown
> **YYYY-MM-DD 主题**（N 轮）
> 角色：XXX | 产出：XXX
> 核心发现：XXX（洞见预览）
> → [详细讨论](链接)
```

---

## 维护触发条件

### 阈值驱动（主触发）

| 条件 | 级别 | 说明 |
|:-----|:-----|:-----|
| 行数 > 800 | SHOULD | 强烈建议触发维护 |
| 行数 > 600 且连续 2 周增长 | SHOULD | 趋势预警 |
| 近 7 天新增 > 200 行 | MAY | 增长率异常 |

### 事件驱动（语义破坏事件）

| 事件 | 级别 | 动作 |
|:-----|:-----|:-----|
| 项目/组件重大更名 | MUST | 过时信息清扫 + 重定向 |
| 目录结构大迁移 | MUST | 链接修复 |
| 团队协议变更 | SHOULD | 格式对齐 |

### 周期驱动（保底机制）

| 周期 | 级别 | 动作 |
|:-----|:-----|:-----|
| 每 30 天 | SHOULD | 至少执行一次维护检查 |

---

## 维护流程 SOP

### 速查清单

```markdown
## 记忆维护速查清单

### 准备阶段
□ 确定维护范围（哪些文件）
□ 创建备份（Git commit 或 archive 快照）
□ 列出"不可删除清单"（Non-Negotiables）

### 执行阶段
□ 分类：Identity / Insight / Index / Archive
□ 洞见提纯：先提取再压缩
□ 过程记录压缩为索引条目
□ 过时信息标记 deprecated 或移除
□ 断链内容留 stub 重定向

### 验收阶段
□ 冷启动测试：读完能理解"我是谁"
□ 链接可达性检查
□ 写入维护日志
```

### 详细步骤

#### 1. 准备阶段

**1.1 确定范围**
```yaml
scope:
  - agent-team/members/<name>/index.md
  - agent-team/members/<name>/meta-cognition.md
```

**1.2 创建备份**

方式一（推荐）：Git commit
```bash
git add -A && git commit -m "chore: pre-maintenance snapshot for <name>"
```

方式二：Archive 快照
```bash
cp agent-team/members/<name>/index.md agent-team/archive/memory-maintenance/YYYY-MM-DD/<name>/index.md.bak
```

**1.3 列出 Non-Negotiables**

维护前先列出本次绝对不能删除的内容：
- 近期形成的核心洞见
- 仍在生效的决策与理由
- 仍被外部文档引用的锚点

#### 2. 执行阶段

**2.1 分类扫描**

逐块检查当前内容，标记分类：
- `[I]` Identity — 保留
- `[S]` Insight — 保留
- `[X]` Index — 压缩为索引条目
- `[A]` Archive — 移到归档

**2.2 洞见提纯**

对每个 `[X]` 标记的块：
1. 识别是否包含洞见信号
2. 如有，提取洞见到 Insight 层
3. 压缩剩余内容为索引条目

**2.3 处理过时信息**

对已被新现实覆盖的内容：
- 如果有替代位置：留 stub 重定向
- 如果完全过时：可直接移除
- 如果不确定：移到 Archive

#### 3. 验收阶段

**3.1 冷启动测试**

把自己当作首次激活的 Agent，检查：
- 读完 Identity+Insight 能否理解"我能提供什么价值"？
- 能否在 30 秒内找到"最近在做什么"的索引入口？

**3.2 链接可达性**

对本次修改涉及的链接，检查是否可达。

**3.3 写入维护日志**

---

## 维护日志

### 日志位置

> **[决议]** 维护日志位于成员级 `agent-team/members/<name>/maintenance-log.md`
> - 理由：信息局部性、避免多成员并发冲突
> - 跨成员检索：团队级索引 `agent-team/archive/memory-maintenance/index.md`

### 日志格式

**简化版**（日常使用）：

```markdown
## YYYY-MM-DD 维护记录

- **执行者**：<name>
- **范围**：index.md
- **触发原因**：行数 > 500
- **变更摘要**：
  - 提纯洞见 3 条
  - 压缩过程记录 12 块 → 索引条目
  - 归档详细讨论到 archive/
- **备份**：`git commit abc123`
- **QA 结果**：冷启动测试通过
```

**完整版**（重大维护时使用）：

```yaml
# MaintenanceRun
runId: MM-2025-12-22-01
actor: Seeker
timestamp: 2025-12-22
scope:
  - agent-team/members/Seeker/index.md
triggers:
  - threshold: lines > 500
actions:
  - extract_insights: 3
  - compress_process_logs: 12
  - archive_blocks: 8
backup:
  method: git-commit
  ref: abc123
qa:
  coldstart_test: pass
  link_check: pass
notes: "压缩 12/14~12/21 的过程性讨论，保留洞见并补索引"
```

---

## 归档策略

### 归档位置

> **[决议]** 归档目录位于团队级 `agent-team/archive/members/<name>/YYYY-MM/`
> - 理由：归档是团队资产，集中管理便于跨成员检索
> - 成员级：`agent-team/members/<name>/archive/` 只放索引链接

### 归档组织方式

> **[决议]** 归档文件按**主题**组织，而非按日期。
>
> **理由**：日期作为索引键在语义检索中效果差（Self-Attention 低）。
> 按主题组织有利于后续检索和知识复用。

**推荐命名**：`<topic>-<date-range>.md`

| ✅ 推荐 | ❌ 不推荐 |
|:--------|:----------|
| `statejournal-reviews-12-16-to-12-21.md` | `2025-12-20-review.md` |
| `docui-design-workshops.md` | `12-13-meeting.md` |
| `naming-convention-discussions.md` | `discussions-dec.md` |

### 归档内容

归档的内容应该：
- **完整保留原始讨论**：不删减
- **添加元数据头**：说明来源和归档原因
- **保持可追溯**：从主文件的索引条目可以链接到

**归档文件头模板**：
```markdown
---
archived_from: members/Seeker/index.md
archived_date: 2025-12-22
archived_by: Seeker
reason: 过程记录压缩
original_section: "2025-12-20 MVP v2 自洽性审阅"
---

# 2025-12-20 MVP v2 自洽性审阅（完整记录）

（原始内容...）
```

---

## 质量保障

### 认知不变量检查

维护后 MUST 满足：

| 检查项 | 标准 |
|:-------|:-----|
| Identity 可读 | Identity 层不超过 80 行，能清晰回答"我是谁/擅长什么" |
| Top Insights 可定位 | 至少 5 条核心洞见有明确标题/小节 |
| Navigation 可达 | 能从索引找到最近 3 次关键参与的详情链接 |
| 结构完整 | 四层结构（Identity/Insight/Index）都存在且有内容 |

### 防过度压缩

| 规则 | 级别 | 说明 |
|:-----|:-----|:-----|
| 删除前先提纯 | MUST | 不能直接删除含洞见的块 |
| 保留证据指针 | SHOULD | 关键洞见保留指向原始讨论的链接 |
| 不引入新含义 | MUST | 摘要只能是复述，不能偷偷加约束 |
| 停止规则 | MAY | 发现在"重新解释历史"时应停止 |

### 变更计数

维护日志 MUST 包含变更计数：
- 新增洞见数
- 压缩块数
- 归档块数
- 删除洞见数（如有，必须解释原因）

---

## 规范条款索引

> **[OPEN QUESTION #3]** 条款分层展示
> - 本文档采用"速查清单 + 详细规范"的分层结构
> - 完整条款体系见附录 A
> - 日常维护只需参考速查清单

### 核心 MUST 条款（速查）

> 以下是附录 A 完整条款的子集视图（informative view），用于日常维护速查。

| ID | 条款 | 说明 |
|:---|:-----|:-----|
| [MM-SAFE-BACKUP-REQUIRED] | 维护前 MUST 创建备份 | Git commit 或 archive 快照 |
| [MM-PROC-EXTRACT-FIRST] | 删除前 MUST 先提纯洞见 | 避免丢失知识 |
| [MM-AUDIT-LOG-LOCATION] | 维护后 MUST 写入日志 | 可追溯性 |
| [MM-ANTI-NO-SEMANTIC] | 压缩 MUST NOT 引入新含义 | 只复述，不改立场 |
| [MM-QA-INVARIANTS] | 维护后 MUST 满足认知不变量 | Identity/Insight/Navigation |
| [MM-AUDIT-APPEND-ONLY] | 维护日志 MUST append-only | 禁止重写旧条目 |

### 核心 SHOULD 条款（速查）

| ID | 条款 | 说明 |
|:---|:-----|:-----|
| [MM-TRIG-LINES] | 行数 > 800 SHOULD 触发维护 | 阈值触发 |
| [MM-PROC-ARCHIVE] | 可回溯内容 SHOULD 归档而非删除 | 保留追溯能力 |
| [MM-QA-COLDSTART] | SHOULD 执行冷启动测试 | 验证可读性 |
| [MM-QA-LINKS] | SHOULD 检查链接可达性 | 避免断链 |

---

## 附录 A：完整条款体系

> 以下条款采用 `[MM-<TOPIC>-<KEY>]` 命名体系。
> TOPIC 集合：GEN（总则）、TRIG（触发）、PROC（流程）、AUDIT（审计）、QA（质量）、SAFE（安全）、ARCH（归档）、ANTI（防过度压缩）

### GEN 总则

- **[MM-GEN-ID-STABLE]** MUST：条款 ID 一经引入不得改名；废弃时用 `Deprecated:` 标记
- **[MM-GEN-ARTIFACTS]** SHOULD：每次维护产出 4 件工件（日志、摘要、备份、QA 结果）

### TRIG 触发

- **[MM-TRIG-LINES]** SHOULD：行数 > 800 时触发维护
- **[MM-TRIG-EVENTS]** MUST：重大改名等语义破坏事件必须触发维护
- **[MM-TRIG-CADENCE]** SHOULD：每 30 天至少执行一次维护检查

### PROC 流程

- **[MM-PROC-SCOPING]** MUST：维护前明确范围与目标
- **[MM-PROC-CLASSIFY]** SHOULD：先分类再动刀（Identity/Insight/Index/Archive）
- **[MM-PROC-EXTRACT-FIRST]** MUST：删除前先执行洞见提纯
- **[MM-PROC-ARCHIVE]** SHOULD：可回溯内容优先归档而非删除
- **[MM-PROC-REDIRECTS]** MUST：移除被引用内容时留 stub 重定向

### AUDIT 审计

- **[MM-AUDIT-LOG-LOCATION]** MUST：每次维护写入追加式维护日志
- **[MM-AUDIT-LOG-FORMAT]** MUST：日志包含执行者、时间、范围、变更摘要、备份信息
- **[MM-AUDIT-TRACEABILITY]** MUST：日志能回链到变更前状态
- **[MM-AUDIT-APPEND-ONLY]** MUST：维护日志只追加，禁止重写旧条目

### QA 质量

- **[MM-QA-INVARIANTS]** MUST：维护后满足认知不变量（Identity/Insight/Navigation）
- **[MM-QA-LINKS]** SHOULD：检查链接可达性
- **[MM-QA-COLDSTART]** SHOULD：执行冷启动阅读测试
- **[MM-QA-DELTA-SUMMARY]** MUST：维护日志包含变更计数

### SAFE 安全

- **[MM-SAFE-BACKUP-REQUIRED]** MUST：维护前创建备份（Git commit 或 archive 快照）
- **[MM-SAFE-BACKUP-SCOPE]** SHOULD：备份覆盖本次涉及的所有文件
- **[MM-SAFE-ROLLBACK]** MUST：日志写明回滚方式

### ARCH 归档

- **[MM-ARCH-STRUCTURE]** SHOULD：统一归档路径 `agent-team/archive/members/<name>/YYYY-MM/`
- **[MM-ARCH-METADATA]** SHOULD：归档文件添加元数据头

### ANTI 防过度压缩

- **[MM-ANTI-NONNEGOTIABLES]** MUST：维护前列出"不可删除清单"
- **[MM-ANTI-EVIDENCE]** SHOULD：关键洞见保留证据指针
- **[MM-ANTI-NO-SEMANTIC]** MUST：压缩不得引入新的规范性含义
- **[MM-ANTI-STOP-RULE]** MAY：发现在"重新解释历史"时应停止压缩

---

## 附录 B：记忆文件目标结构模板

```markdown
# <Name> — 认知入口

> **身份**: <角色描述>
> **驱动模型**: <模型名称>
> **首次激活**: <日期>

---

## 身份简介（Identity）

（我是谁，约 30 行）

---

## 专长领域（Identity）

（我擅长什么，约 20 行）

---

## 核心洞见（Insight）

### 方法论
- <方法论 1>
- <方法论 2>
- ...

### 经验教训
- <教训 1>
- <教训 2>
- ...

### 重要决策参与
（精选 3-5 个最重要的，其他放 Index）

---

## 参与历史索引（Index）

| 日期 | 主题 | 角色 | 关键产出 | 详细记录 |
|:-----|:-----|:-----|:---------|:---------|
| 2025-12-20 | MVP v2 审阅 | 概念框架 | 14 项问题 | [链接] |
| ... | ... | ... | ... | ... |

---

## 认知文件结构

（文件组织说明，约 10 行）

---

## 最后更新

**YYYY-MM-DD** — 最近一次重要活动的简要描述
```

---

## 附录 C：决议记录

> 以下决议由 2025-12-22 畅谈会确定

### 决议 #1：维护日志位置

**决议**：选 A（成员级）

| 选项 | 路径 | 结果 |
|:-----|:-----|:-----|
| ✅ A | `agent-team/members/<name>/maintenance-log.md` | **采纳** |
| B | `agent-team/archive/memory-maintenance/log.md` | 仅作为跨成员索引 |

**理由**：信息局部性、避免多成员并发冲突

### 决议 #2：归档目录结构

**决议**：选 B（团队级）

| 选项 | 路径 | 结果 |
|:-----|:-----|:-----|
| A | `agent-team/members/<name>/archive/` | 仅放索引链接 |
| ✅ B | `agent-team/archive/members/<name>/YYYY-MM/` | **采纳** |

**理由**：归档是团队资产，集中管理便于跨成员检索

### 决议 #3：条款体系复杂度

**决议**：保持现状，优先修复一致性

- 速查表是附录 A 的子集视图（informative view）
- 条款 ID 必须一致（速查表引用附录 A 的正式 ID）
- 路径 SSOT 唯一化

---

## 变更日志

| 日期 | 版本 | 变更 |
|:-----|:-----|:-----|
| 2025-12-22 | v1.0 | 正式版，根据畅谈会第二轮审阅修订：<br>- 解决 3 个 Open Questions<br>- 添加术语定义区<br>- 放宽 Token 预算（150%）<br>- 统一条款 ID 一致性<br>- 添加 append-only 约束<br>- 更新路径为完整路径 |
| 2025-12-22 | v0.1 | 初稿，基于畅谈会第一轮讨论成果 |

````