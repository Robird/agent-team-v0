# Agent 审阅特性对比与 Recipe 设计

> **目的**：基于 Craftsman 和 Curator 的实验结果，设计系统化的文档审阅流程。

---

## §1 Agent 特性对比

### 1.1 极简提示词（C1 vs E1）

| 维度 | Craftsman E1 | Curator C1 |
|:-----|:-------------|:-----------|
| 问题数 | 6 | 6 |
| 伪问题 | 2 | 0 |
| 价值比 | 33% | **83%** |
| 默认风格 | 审计师倾向 | 工程师倾向 |

**结论**：Curator 的默认行为更工程化，即使不用特殊提示词也能避免伪问题。

### 1.2 工程师视角（C6 vs E6）

| 维度 | Craftsman E6 | Curator C6 |
|:-----|:-------------|:-----------|
| 问题数 | 8 | 8 |
| 问题重叠 | - | **100%** |
| 伪问题 | 0 | 0 |
| 输出结构 | 列表式 | 每问题结构化 |
| "后果分析" | 分散 | 每问题独立段落 |

**结论**：两者发现相同问题，但 Curator 输出更适合后续处理。

### 1.3 Agent 角色定位

| Agent | 擅长 | 不擅长 | 推荐用途 |
|:------|:-----|:-------|:---------|
| **Craftsman** | 深度分析、边界情况 | 默认可能产生伪问题 | 精确审阅（需好提示词）|
| **Curator** | 结构化输出、分类 | （暂无明显短板）| 问题发现 + 分类 |

---

## §2 问题分类规范

基于 C6/E6 的输出，建立问题分类体系：

### 2.1 按影响分类

| 类别 | 定义 | 处理优先级 | 示例 |
|:-----|:-----|:-----------|:-----|
| **P0-Critical** | 会导致数据损坏/安全漏洞 | 立即修复 | - |
| **P1-High** | 会导致实现错误 | 必须修复 | SizedPtr 粒度、FrameStatus 校验缺失 |
| **P2-Medium** | 可能导致误解 | 应该修复 | LengthBytes == HeadLen 未钉死 |
| **P3-Low** | 建议改进 | 可选修复 | Flush 可见性语义 |

### 2.2 按类型分类

| 类型 | 定义 | 典型处理方式 |
|:-----|:-----|:-------------|
| **Contradiction** | 文档 A 与 B 矛盾 | 裁决 + 统一 |
| **Ambiguity** | 表述模糊，可多种解读 | 精确化 |
| **Omission** | 缺少必要信息 | 补充 |
| **Inconsistency** | 术语/数值不一致 | 统一 |

### 2.3 C6/E6 问题分类示例

| # | 问题 | 影响 | 类型 | 处理方式 |
|---|------|------|------|----------|
| 1 | SizedPtr 粒度 | P1 | Ambiguity | 明确属性返回值单位 |
| 2 | HeadLen 术语 | P2 | Inconsistency | 统一术语 |
| 3 | 缺 FrameStatus 校验 | P1 | Omission | 补充伪代码 |
| 4 | 解析步骤缺失 | P1 | Omission | 补充推导逻辑 |
| 5 | LengthBytes 等式 | P2 | Ambiguity | 显式声明 |
| 6 | TryReadAt 校验 | P2 | Ambiguity | 补充失败条件 |
| 7 | Flush 语义 | P3 | Ambiguity | 补充保证 |
| 8 | DataTail 陷阱 | P2 | Ambiguity | 明确值域 |

---

## §3 Recipe 设计草案

### 3.1 流程概览

```
┌─────────────┐
│  1. 发现    │ ← Curator + 工程师视角提示词
└──────┬──────┘
       ↓
┌─────────────┐
│  2. 分类    │ ← Curator + 分类提示词
└──────┬──────┘
       ↓
┌─────────────┐
│  3. 处理    │ ← 按类型分派
└──────┬──────┘
       ↓
┌─────────────┐
│  4. 验证    │ ← Craftsman + 验证提示词
└──────┬──────┘
       ↓
┌─────────────┐
│  5. 报告    │ ← 需外部决策的问题
└─────────────┘
```

### 3.2 阶段详情

#### 阶段 1：发现

**执行者**：Curator
**提示词模板**：
```markdown
你是一位**准备实现 [系统名称] 的工程师**，正在阅读以下设计文档：
- [文件列表]

你需要确保自己理解正确，不会因为文档描述的歧义而写出错误的代码。

请指出文档中**可能让你写错代码的地方**。只关注会导致实现错误的问题，不关注文档风格。

对于每个问题，请说明：
1. 位置（章节/条款）
2. 问题描述
3. 如果理解错了会怎样
4. 建议修复方式
```

**输出**：问题清单

#### 阶段 2：分类

**执行者**：Curator
**提示词模板**：
```markdown
对以下问题进行分类：

[问题清单]

**影响分类**：
- P0-Critical：会导致数据损坏/安全漏洞
- P1-High：会导致实现错误
- P2-Medium：可能导致误解
- P3-Low：建议改进

**类型分类**：
- Contradiction：文档 A 与 B 矛盾
- Ambiguity：表述模糊
- Omission：缺少必要信息
- Inconsistency：术语/数值不一致

请输出分类后的表格，并标注哪些需要外部决策。
```

**输出**：分类表 + 外部决策列表

#### 阶段 3：处理

**执行者**：按类型分派
| 类型 | 处理者 | 处理方式 |
|:-----|:-------|:---------|
| Contradiction | **人工裁决** | 监护人决定正确版本 |
| Ambiguity | Curator | 提出精确化表述 |
| Omission | Curator | 提出补充内容 |
| Inconsistency | Curator | 提出统一方案 |

**输出**：修订建议清单

#### 阶段 4：验证

**执行者**：Craftsman
**提示词模板**：
```markdown
验证以下修订是否解决了原问题：

**原问题**：[问题描述]
**修订内容**：[修订前后对比]

请检查：
1. 修订是否解决了原问题
2. 修订是否引入新问题
3. 修订是否与其他文档一致

输出 PASS/FAIL 及理由。
```

**输出**：验证结果

#### 阶段 5：报告

**内容**：
- 已自动处理的问题（Ambiguity/Omission/Inconsistency）
- 需人工裁决的问题（Contradiction）
- 验证失败需重做的问题

---

## §4 待验证假设

1. **Curator 是否适合做"分类"**：需要测试分类提示词
2. **Craftsman 是否适合做"验证"**：需要测试验证提示词
3. **Contradiction 是否总需要人工**：某些可能有明显正确答案
4. **流程是否需要迭代**：修订可能引入新问题

---

## §5 下一步

### 5.1 继续实验

- [ ] 测试 Curator 的分类能力
- [ ] 测试 Craftsman 的验证能力
- [ ] 测试 Investigator 的调查能力（用于 Contradiction）

### 5.2 编写正式 Recipe

待实验完成后，在 `agent-team/how-to/` 下创建：
- `review-design-docs.md`：完整流程
- `classify-doc-issues.md`：分类规范
- `resolve-doc-contradictions.md`：矛盾处理指南

### 5.3 应用于 RBF 文档

将 C6/E6 发现的 8 个问题作为测试用例，验证完整流程。

---

*文档版本：v0.1*  
*创建日期：2026-01-06*  
*状态：草案，待实验验证*
