# E6: 角色设定

## 输入提示词

```
你是一位**准备实现 RBF 库的工程师**，正在阅读以下两份设计文档：

- `/repos/focus/atelia/docs/Rbf/rbf-interface.md`
- `/repos/focus/atelia/docs/Rbf/rbf-format.md`

你需要确保自己理解正确，不会因为文档描述的歧义而写出错误的代码。

请指出文档中**可能让你写错代码的地方**。只关注会导致实现错误的问题，不关注文档风格。
```

**字数**：115 字

## 输出反馈

### 问题清单（8 个）

1. **SizedPtr bit/bytes/4B 粒度**：Packed 存 bytes 还是 bytes/4？shift 搞反会导致定位错误
2. **Reverse Scan HeadLen 下限**：§3.3 说最小 20，§6.1 伪码用 16，会接受非法帧
3. **Reverse Scan 缺少 §5 校验**：算法没验证 FrameStatus，漏检会接受非法帧
4. **FrameStatus 解析步骤**：先有鸡还是先有蛋？没给规范解法
5. **LengthBytes == HeadLen**：没用 MUST 钉死等式，TryReadAt 可能读半帧
6. **TryReadAt Fence 校验**：没写清楚要验证什么，可能接受"伪帧"
7. **Flush 与 open Builder**："不可观测"定义模糊，可能在崩溃恢复时误判
8. **DataTail 复用 SizedPtr**：会诱发错误的对齐/验证逻辑

### 附加输出

提供了"3 个必须钉死的裁决"建议。

## 分析

### 问题质量评估

| # | 问题 | 价值判断 | 理由 |
|---|:-----|:---------|:-----|
| 1 | SizedPtr 位/粒度 | ✅ 高价值 | 会导致 wire 写错 |
| 2 | HeadLen 下限 | ✅ 高价值 | 会接受非法帧 |
| 3 | 校验集合缺失 | ✅ 高价值 | 会漏检非法帧 |
| 4 | 解析步骤不明 | ✅ 高价值 | 会读错边界 |
| 5 | LengthBytes 等式 | ⚠️ 中等 | 需要明确约束 |
| 6 | TryReadAt 校验 | ✅ 高价值 | 会接受伪帧 |
| 7 | Flush 语义 | ⚠️ 中等 | 边界情况 |
| 8 | DataTail 复用 | ⚠️ 中等 | 设计层面 |

### 统计

- 总问题数：**8**
- 高价值问题：**5**（1-4, 6）
- 中等价值：**3**（5, 7, 8）
- 伪问题：**0**
- **价值比**：**62.5%（严格）/ 100%（含中等）**

## 观察

### 角色设定的显著效果

1. **问题深度最高**：发现了 E1-E5 都没发现的问题（2-8）
2. **从实现者视角审阅**：每个问题都说明"会导致什么错误实现"
3. **主动提供"裁决建议"**：不只发现问题，还建议如何修复
4. **问题数增加但无伪问题**：8 个问题全是实质性问题

### 与其他实验对比

| 实验 | 问题数 | 高价值 | 伪问题 | 深度 |
|:-----|:------:|:------:|:------:|:----:|
| E1 极简 | 6 | 2 | 2 | 中 |
| E2 限定 | 3 | 2 | 0 | 中 |
| E3 正向 | 1 | 1 | 0 | 高 |
| E4 负向 | 1 | 1 | 0 | 高 |
| E5 任务 | 1 | 1 | 0 | 中 |
| **E6 角色** | **8** | **5** | **0** | **最高** |

## 关键发现

### "工程师视角"是高价值发现的关键

**为什么有效**：
1. 让 Craftsman 从"审计师"转为"实现者"
2. 关注点从"文档形式"转为"实现正确性"
3. 每个问题都有"会导致什么错误"的具体解释
4. 主动思考"边界情况"和"实现陷阱"

### 新发现的真问题

E1-E5 都只发现了 SizedPtr 位/粒度问题，而 E6 额外发现：
- Reverse Scan 算法与规范不一致（2, 3）
- FrameStatus 解析步骤缺失（4）
- TryReadAt 校验要求不明（6）
- Flush 语义模糊（7）
- DataTail 复用问题（8）

这些是**真正有价值的设计反馈**。

## 提示词技巧

### 角色设定的关键要素

```markdown
你是一位**准备实现 XXX 的工程师**，正在阅读以下设计文档...

你需要确保自己理解正确，不会因为文档描述的歧义而写出错误的代码。

请指出文档中**可能让你写错代码的地方**。
```

### 为什么有效

1. **角色定位**：从审计师 → 实现者
2. **目标明确**："不会写错代码"
3. **关注点聚焦**："可能让你写错代码的地方"
4. **隐式排除**：实现者不关心"证据链"、"可追溯性"

## 提示词模板 v3（工程师视角）

```markdown
你是一位**准备实现 [系统名称] 的工程师**，正在阅读以下设计文档：

- [文件列表]

你需要确保自己理解正确，不会因为文档描述的歧义而写出错误的代码。

请指出文档中**可能让你写错代码的地方**。只关注会导致实现错误的问题，不关注文档风格。
```

## 重大发现

**角色设定是 Craftsman 最佳使用方式！**

- 让 Craftsman 扮演"实现者"而非"审计师"
- 自动过滤伪问题（实现者不关心）
- 自动增加深度（实现者关心边界情况）
- 主动提供修复建议（实现者思维）
