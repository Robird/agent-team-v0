# 超平面发现提示词模板

> **用途**：在 Shape-Tier 阶段，帮助 AI Agent 识别软件需求中的"复杂性切分点"

## 核心概念

**超平面（Hyperplane）**：在高维复杂性空间中，把问题切分成相对独立子空间的边界。好的超平面具有：
- **低耦合**：切分后两部分之间的接口最小
- **高内聚**：每部分内部的概念紧密相关
- **单向依赖**：A 依赖 B，但 B 不依赖 A
- **可独立验证**：每部分可以独立测试

## 提示词模板

```markdown
你是一个软件架构分析专家。你的任务是在复杂需求中找到"超平面"——即把高维复杂性空间切分成相对独立的低维子空间的边界。

## 超平面评估标准

一个好的超平面切分点具有以下特征（必须逐条评估）：
1. **低耦合**：切分后的两部分之间的接口最小化（理想：仅传递不可变数据）
2. **高内聚**：每部分内部的概念紧密相关（理想：同一领域语言）
3. **单向依赖**：A 依赖 B，但 B 不依赖 A（理想：无环）
4. **可独立验证**：每部分可以独立测试（理想：可 mock 边界）

## 超平面发现算法

对于给定需求，按以下步骤分析：

**Step 1: 识别概念节点**
列出需求中的所有核心概念（名词），标注其所属领域

**Step 2: 识别操作节点**
列出需求中的所有核心操作（动词），标注其输入输出

**Step 3: 构建依赖图**
用文本或简图表示概念和操作之间的依赖关系

**Step 4: 寻找切分点**
在依赖图中找到"瓶颈"——通过最少边连接两个相对独立子图的位置

**Step 5: 评估切分点**
对每个候选切分点，用四条标准逐一评估，给出 ✅ 或 ⚠️

**Step 6: 定义接口**
为每个通过评估的切分点定义最小接口

## 渐进式构建原则

在识别超平面后，按以下原则排序子任务：

1. **最小可成功单元优先**：找出"无论如何都会成功"的最基础步骤
2. **推迟决策**：遇到不确定的设计选择，标记为 OpenQuestion
3. **扩展点优先**：用接口预留扩展能力，而非硬编码类型判断

---

## 待分析需求

{在此插入具体需求描述}

---

请按照上述算法和原则，输出：
1. 概念/操作清单
2. 依赖图
3. 超平面切分点（含评估）
4. 推荐的子任务序列
5. OpenQuestion 列表
```

## 使用指南

### 何时使用

- **Shape-Tier 初期**：需求已明确，开始设计时
- **设计审阅**：检查现有设计是否存在更好的切分点
- **重构评估**：判断是否值得引入新的抽象层

### 如何集成到工作流

1. **Investigator** 收集需求后，用此模板分析
2. **Craftsman** 审阅切分方案，挑战评估结论
3. **TeamLeader** 基于切分点定义 Task Brief
4. **Implementer** 按子任务顺序实施

### 迭代改进

每次使用后记录：
- 哪些切分点在实施中被证明正确？
- 哪些需要调整？
- 有哪些模式可以提炼成"预置超平面"？

## 预置超平面模式（持续积累）

| 问题类型 | 常见超平面 | 接口形式 |
|:---------|:-----------|:---------|
| **解析器** | 词法/语法/语义 | Token[], AST, SemanticModel |
| **构建器** | 收集/中间表示/最终构建 | RawData, IR, Output |
| **转换器** | 输入适配/核心转换/输出适配 | NormalizedInput, Result |
| **职责链** | 框架/具体处理器 | IHandler, Context |

## 实验记录

### 2026-01-13 DesignDsl 实验

**需求**：Markdown → AxtTree（含 TermNode/ClauseNode）

**发现的超平面**：
1. H1: Block → HeadingInfo（隔离 Markdig）
2. H2: HeadingInfo → NodeDescriptor（文本→结构）
3. H3: 框架 → Pattern（扩展点）
4. H4: 骨架 → 内容（可选）

**实际采用**：
- 分段器（对应 H1）
- INodeBuilder 框架（对应 H2+H3）
- AxtTreeBuilder（结构构建）

**洞见**：
- 三种提示词策略产出不同但都合理的方案
- "评估标准"显式化有助于产出可验证的切分点
- "算法步骤"显式化提高输出结构性

---

*变更日志*：
- 2026-01-13: 初版，基于 DesignDsl 实验提炼
