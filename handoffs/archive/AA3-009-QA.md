# AA3-009 QA – CL4 Decorations & DocUI

## Scope & References
- Mission: validate the CL4 decoration trees + DocUI diff renderer fixes delivered under [`agent-team/handoffs/AA3-008-Result.md`](AA3-008-Result.md), focusing on AA3-007 F1–F4 scenarios (metadata round-trip, stickiness/`acceptReplace`, injected text queries, glyph/minimap/overview annotations, diff decoration visibility).
- Changefeed alignment: no new delta entry required; QA ties back to the existing **AA3-008** record at [`agent-team/indexes/README.md#delta-2025-11-20`](../indexes/README.md#delta-2025-11-20).

## Validated Coverage
| Area | What was exercised | Tests |
| --- | --- | --- |
| Decoration metadata parity (F1/F2) | Ensured injected text surfaces through `GetInjectedTextInLine`, glyph/margin/font helpers opt-in, and metadata-rich change events remain wired. | `DecorationTests.InjectedTextQueriesSurfaceLineMetadata`, `DecorationTests.DecorationOptionsParityRoundTripsMetadata`, `DecorationTests.DecorationsChangedEventIncludesMetadata` |
| Stickiness & `forceMoveMarkers` semantics (F3) | Confirmed collapsed ranges honor TS stickiness defaults unless the edit pipeline sets `forceMoveMarkers`, matching `DecorationRangeUpdater`. | `DecorationTests.ForceMoveMarkersOverridesStickinessDefaults` |
| DocUI diff snapshots (F4) | Verified Markdown renderer emits diff add/delete/insertion markers plus annotations without re-running search. | `MarkdownRendererTests.TestRender_DiffDecorationsExposeGenericMarkers` |

## Artifacts Updated
- `src/PieceTree.TextBuffer.Tests/DecorationTests.cs` – new injected-text + force-move parity suites.
- `src/PieceTree.TextBuffer.Tests/MarkdownRendererTests.cs` – diff snapshot visibility test for generic decorations.
- `src/PieceTree.TextBuffer.Tests/TestMatrix.md` – recorded AA3-009 coverage rows and refreshed totals (88 tests).
- Planning/status docs (`docs/reports/audit-checklist-aa3.md`, `agent-team/task-board.md`, `docs/sprints/sprint-01.md`, `AGENTS.md`) will reference this QA outcome.

## Test Log
```
cd /repos/PieceTreeSharp && dotnet test src/PieceTree.TextBuffer.Tests/PieceTree.TextBuffer.Tests.csproj
Total tests: 88. Passed: 88. Failed: 0. Skipped: 0. Duration: 2.3s.
```

## Notes / Follow-ups
- No regressions observed; DocUI diff and decoration helpers are deemed ready for downstream DocMaintainer validation.
- Next coordination: Info-Indexer/DocMaintainer can reuse the AA3-008 changefeed entry when broadcasting CL4 status.
